<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>The Messaging Layer Security (MLS) Extensions</title>
<meta content="Raphael Robert" name="author">
<meta content="
       This document describes extensions to the Messaging Layer Security (MLS) protocol. 
    " name="description">
<meta content="xml2rfc 3.25.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-mls-extensions-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.25.0
    Python 3.12.8
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.5
    lxml 5.3.0
    platformdirs 4.3.6
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-mls-extensions.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">MLS</td>
<td class="right">January 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Robert</td>
<td class="center">Expires 27 July 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-mls-extensions-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-01-23" class="published">23 January 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-07-27">27 July 2025</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. Robert</div>
<div class="org">Phoenix R&amp;D</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">The Messaging Layer Security (MLS) Extensions</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes extensions to the Messaging Layer Security (MLS) protocol.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
  <span><a href="https://github.com/mlswg/mls-extensions">https://github.com/mlswg/mls-extensions</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 27 July 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-change-log" class="internal xref">Change Log</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-safe-extensions" class="internal xref">Safe Extensions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-safe-extension-api" class="internal xref">Safe Extension API</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.1">
                    <p id="section-toc.1-1.2.2.1.2.1.1" class="keepWithNext"><a href="#section-2.1.1" class="auto internal xref">2.1.1</a>.  <a href="#name-security" class="internal xref">Security</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.2">
                    <p id="section-toc.1-1.2.2.1.2.2.1"><a href="#section-2.1.2" class="auto internal xref">2.1.2</a>.  <a href="#name-core-struct-extensions" class="internal xref">Core Struct Extensions</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.3">
                    <p id="section-toc.1-1.2.2.1.2.3.1"><a href="#section-2.1.3" class="auto internal xref">2.1.3</a>.  <a href="#name-common-data-structures" class="internal xref">Common Data Structures</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.4">
                    <p id="section-toc.1-1.2.2.1.2.4.1"><a href="#section-2.1.4" class="auto internal xref">2.1.4</a>.  <a href="#name-negotiating-support-for-saf" class="internal xref">Negotiating Support for Safe Extensions</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.5">
                    <p id="section-toc.1-1.2.2.1.2.5.1"><a href="#section-2.1.5" class="auto internal xref">2.1.5</a>.  <a href="#name-hybrid-public-key-encryptio" class="internal xref">Hybrid Public Key Encryption (HPKE)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.6">
                    <p id="section-toc.1-1.2.2.1.2.6.1"><a href="#section-2.1.6" class="auto internal xref">2.1.6</a>.  <a href="#name-signature-keys" class="internal xref">Signature Keys</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.7">
                    <p id="section-toc.1-1.2.2.1.2.7.1"><a href="#section-2.1.7" class="auto internal xref">2.1.7</a>.  <a href="#name-exporting-secrets" class="internal xref">Exporting Secrets</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.8">
                    <p id="section-toc.1-1.2.2.1.2.8.1"><a href="#section-2.1.8" class="auto internal xref">2.1.8</a>.  <a href="#name-pre-shared-keys-psks" class="internal xref">Pre-Shared Keys (PSKs)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.9">
                    <p id="section-toc.1-1.2.2.1.2.9.1"><a href="#section-2.1.9" class="auto internal xref">2.1.9</a>.  <a href="#name-extension-designer-tools" class="internal xref">Extension Designer Tools</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.10">
                    <p id="section-toc.1-1.2.2.1.2.10.1"><a href="#section-2.1.10" class="auto internal xref">2.1.10</a>. <a href="#name-extension-state-anchoring-s" class="internal xref">Extension state: anchoring, storage and agreement</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-extension-design-guidance" class="internal xref">Extension Design Guidance</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-extensions" class="internal xref">Extensions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-appack" class="internal xref">AppAck</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="auto internal xref">3.1.1</a>.  <a href="#name-description" class="internal xref">Description</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-targeted-messages" class="internal xref">Targeted messages</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="auto internal xref">3.2.1</a>.  <a href="#name-description-2" class="internal xref">Description</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="auto internal xref">3.2.2</a>.  <a href="#name-format" class="internal xref">Format</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.3">
                    <p id="section-toc.1-1.3.2.2.2.3.1"><a href="#section-3.2.3" class="auto internal xref">3.2.3</a>.  <a href="#name-encryption" class="internal xref">Encryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.4">
                    <p id="section-toc.1-1.3.2.2.2.4.1"><a href="#section-3.2.4" class="auto internal xref">3.2.4</a>.  <a href="#name-authentication" class="internal xref">Authentication</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.5">
                    <p id="section-toc.1-1.3.2.2.2.5.1"><a href="#section-3.2.5" class="auto internal xref">3.2.5</a>.  <a href="#name-guidance-on-authentication-" class="internal xref">Guidance on authentication schemes</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-content-advertisement" class="internal xref">Content Advertisement</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="auto internal xref">3.3.1</a>.  <a href="#name-description-3" class="internal xref">Description</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="auto internal xref">3.3.2</a>.  <a href="#name-syntax" class="internal xref">Syntax</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.3">
                    <p id="section-toc.1-1.3.2.3.2.3.1"><a href="#section-3.3.3" class="auto internal xref">3.3.3</a>.  <a href="#name-expected-behavior" class="internal xref">Expected Behavior</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.4">
                    <p id="section-toc.1-1.3.2.3.2.4.1"><a href="#section-3.3.4" class="auto internal xref">3.3.4</a>.  <a href="#name-framing-of-application_data" class="internal xref">Framing of application_data</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="auto internal xref">3.4</a>.  <a href="#name-selfremove-proposal" class="internal xref">SelfRemove Proposal</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.1">
                    <p id="section-toc.1-1.3.2.4.2.1.1"><a href="#section-3.4.1" class="auto internal xref">3.4.1</a>.  <a href="#name-extension-description" class="internal xref">Extension Description</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="auto internal xref">3.5</a>.  <a href="#name-last-resort-keypackages" class="internal xref">Last resort KeyPackages</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5.2.1">
                    <p id="section-toc.1-1.3.2.5.2.1.1"><a href="#section-3.5.1" class="auto internal xref">3.5.1</a>.  <a href="#name-description-4" class="internal xref">Description</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5.2.2">
                    <p id="section-toc.1-1.3.2.5.2.2.1"><a href="#section-3.5.2" class="auto internal xref">3.5.2</a>.  <a href="#name-format-2" class="internal xref">Format</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-mls-wire-formats" class="internal xref">MLS Wire Formats</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-mls-extension-message" class="internal xref">MLS Extension Message</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-mls-extension-types" class="internal xref">MLS Extension Types</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="auto internal xref">4.2.1</a>.  <a href="#name-targeted_messages_capabilit" class="internal xref">targeted_messages_capability MLS Extension</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="auto internal xref">4.2.2</a>.  <a href="#name-targeted_messages-mls-exten" class="internal xref">targeted_messages MLS Extension</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.3">
                    <p id="section-toc.1-1.4.2.2.2.3.1"><a href="#section-4.2.3" class="auto internal xref">4.2.3</a>.  <a href="#name-accepted_media_types-mls-ex" class="internal xref">accepted_media_types MLS Extension</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.4">
                    <p id="section-toc.1-1.4.2.2.2.4.1"><a href="#section-4.2.4" class="auto internal xref">4.2.4</a>.  <a href="#name-required_media_types-mls-ex" class="internal xref">required_media_types MLS Extension</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.5">
                    <p id="section-toc.1-1.4.2.2.2.5.1"><a href="#section-4.2.5" class="auto internal xref">4.2.5</a>.  <a href="#name-last_resort_key_package-mls" class="internal xref">last_resort_key_package MLS Extension</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.6">
                    <p id="section-toc.1-1.4.2.2.2.6.1"><a href="#section-4.2.6" class="auto internal xref">4.2.6</a>.  <a href="#name-extension_aad-mls-extension" class="internal xref">extension_aad MLS Extension</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.7">
                    <p id="section-toc.1-1.4.2.2.2.7.1"><a href="#section-4.2.7" class="auto internal xref">4.2.7</a>.  <a href="#name-safe_extensions-mls-extensi" class="internal xref">safe_extensions MLS Extension</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.8">
                    <p id="section-toc.1-1.4.2.2.2.8.1"><a href="#section-4.2.8" class="auto internal xref">4.2.8</a>.  <a href="#name-core_struct_extensions-mls-" class="internal xref">core_struct_extensions MLS Extension</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-mls-proposal-types" class="internal xref">MLS Proposal Types</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="auto internal xref">4.3.1</a>.  <a href="#name-extension-proposal" class="internal xref">Extension Proposal</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="auto internal xref">4.3.2</a>.  <a href="#name-extension-path-proposal" class="internal xref">Extension Path Proposal</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.3">
                    <p id="section-toc.1-1.4.2.3.2.3.1"><a href="#section-4.3.3" class="auto internal xref">4.3.3</a>.  <a href="#name-extension-external-proposal" class="internal xref">Extension External Proposal</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.4">
                    <p id="section-toc.1-1.4.2.3.2.4.1"><a href="#section-4.3.4" class="auto internal xref">4.3.4</a>.  <a href="#name-appack-proposal" class="internal xref">AppAck Proposal</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.5">
                    <p id="section-toc.1-1.4.2.3.2.5.1"><a href="#section-4.3.5" class="auto internal xref">4.3.5</a>.  <a href="#name-selfremove-proposal-2" class="internal xref">SelfRemove Proposal</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-mls-credential-types" class="internal xref">MLS Credential Types</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.1">
                    <p id="section-toc.1-1.4.2.4.2.1.1"><a href="#section-4.4.1" class="auto internal xref">4.4.1</a>.  <a href="#name-extension-credential" class="internal xref">Extension Credential</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-mls-signature-labels" class="internal xref">MLS Signature Labels</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.1">
                    <p id="section-toc.1-1.4.2.5.2.1.1"><a href="#section-4.5.1" class="auto internal xref">4.5.1</a>.  <a href="#name-labeled-extension-content" class="internal xref">Labeled Extension Content</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-mls-extension-types-2" class="internal xref">MLS Extension Types</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-security-considerations" class="internal xref">Security considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-appack-2" class="internal xref">AppAck</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-targeted-messages-2" class="internal xref">Targeted Messages</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-content-advertisement-2" class="internal xref">Content Advertisement</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-selfremove" class="internal xref">SelfRemove</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-contributors" class="internal xref">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document describes extensions to <span>[<a href="#mls-protocol" class="cite xref">mls-protocol</a>]</span> that are not part of the
main protocol specification. The protocol specification includes a set of core
extensions that are likely to be useful to many applications. The extensions
described in this document are intended to be used by applications that need to
extend the MLS protocol.<a href="#section-1-1" class="pilcrow">¶</a></p>
<div id="change-log">
<section id="section-1.1">
        <h3 id="name-change-log">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-change-log" class="section-name selfRef">Change Log</a>
        </h3>
<p id="section-1.1-1">RFC EDITOR PLEASE DELETE THIS SECTION.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">draft-05<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-3.1">
            <p id="section-1.1-3.1.1">Include definition of ExtensionState extension<a href="#section-1.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-3.2">
            <p id="section-1.1-3.2.1">Add safe use of AAD to Safe Extensions framework<a href="#section-1.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-3.3">
            <p id="section-1.1-3.3.1">Clarify how capabilities negotiation works in Safe Extensions framework<a href="#section-1.1-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-4">draft-04<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-5.1">
            <p id="section-1.1-5.1.1">No changes (prevent expiration)<a href="#section-1.1-5.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-6">draft-03<a href="#section-1.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-7.1">
            <p id="section-1.1-7.1.1">Add Last Resort KeyPackage extension<a href="#section-1.1-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-7.2">
            <p id="section-1.1-7.2.1">Add Safe Extensions framework<a href="#section-1.1-7.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-7.3">
            <p id="section-1.1-7.3.1">Add SelfRemove Proposal<a href="#section-1.1-7.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-8">draft-02<a href="#section-1.1-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-9.1">
            <p id="section-1.1-9.1.1">No changes (prevent expiration)<a href="#section-1.1-9.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-10">draft-01<a href="#section-1.1-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-11.1">
            <p id="section-1.1-11.1.1">Add Content Advertisement extensions<a href="#section-1.1-11.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-12">draft-00<a href="#section-1.1-12" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-13.1">
            <p id="section-1.1-13.1.1">Initial adoption of draft-robert-mls-protocol-00 as a WG item.<a href="#section-1.1-13.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-13.2">
            <p id="section-1.1-13.2.1">Add Targeted Messages extension (*)<a href="#section-1.1-13.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="safe-extensions">
<section id="section-2">
      <h2 id="name-safe-extensions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-safe-extensions" class="section-name selfRef">Safe Extensions</a>
      </h2>
<p id="section-2-1">The MLS specification is extensible in a variety of ways (see Section 13 of
<span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span>) and describes the negotiation and other handling of extensions and
their data within the protocol. However, it does not provide guidance on how
extensions can or should safely interact with the base MLS protocol. The goal of
this section is to simplify the task of developing MLS extensions.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">More concretely, this section defines the Safe Extension API, a library of
extension components which simplifies development and security analysis of
extensions, provides general guidance on using the built-in functionality of the
base MLS protocol to build extensions, defines specific examples of extensions
built on top of the Safe Extension API alongside the built-in mechanisms of the
base MLS protocol, defines a number of labels registered in IANA which can be
safely used by extensions, so that the only value an extension developer must
add to the IANA registry itself is a unique ExtensionType.<a href="#section-2-2" class="pilcrow">¶</a></p>
<div id="safe-extension-api">
<section id="section-2.1">
        <h3 id="name-safe-extension-api">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-safe-extension-api" class="section-name selfRef">Safe Extension API</a>
        </h3>
<p id="section-2.1-1">The Safe Extension API is a library that defines a number of components from
which extensions can be built. In particular, these components provide
extensions the ability to:<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-2.1">
            <p id="section-2.1-2.1.1">Make use of selected private and public key material from the MLS
specification, e.g. to encrypt, decrypt, sign, verify and derive fresh key
material.<a href="#section-2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-2.2">
            <p id="section-2.1-2.2.1">Inject key material via PSKs in a safe way to facilitate state agreement
without the use of a group context extension.<a href="#section-2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-2.3">
            <p id="section-2.1-2.3.1">Export secrets from MLS in a way that, in contrast to the built-in export
functionality of MLS, preserves forward secrecy of the exported secrets within
an epoch.<a href="#section-2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-2.4">
            <p id="section-2.1-2.4.1">Define new WireFormat, Proposal, Credential, GroupContext, GroupInfo,
KeyPackage, and LeafNode extensions which can interact safely with arbitrary
sets of other current or future Safe Extensions.<a href="#section-2.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-2.5">
            <p id="section-2.1-2.5.1">Anchor extension-specific state in an MLS group to ensure agreement and manage
state acces authorization across extensions.<a href="#section-2.1-2.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.1-3">The Safe Extension API is not an extension itself, it only defines components
from which other extensions can be built. Some of these components modify the
MLS protocol and, therefore, so do the extensions built from them.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">Where possible, the API makes use of mechanisms defined in the MLS
specification. For example, part of the safe API is the use of the
<code>SignWithLabel</code> function described in Section 5.1.2 of <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span>.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<div id="security">
<section id="section-2.1.1">
          <h4 id="name-security">
<a href="#section-2.1.1" class="section-number selfRef">2.1.1. </a><a href="#name-security" class="section-name selfRef">Security</a>
          </h4>
<p id="section-2.1.1-1">An extension is called safe if it does not modify the base MLS protocol or other
MLS extensions beyond using components of the Safe Extension API. The Safe
Extension API provides the following security guarantee: If an application uses
MLS and only safe MLS extensions, then the security guarantees of the base MLS
protocol and the security guarantees of safe extensions, each analyzed in
isolation, still hold for the composed extended MLS protocol. In other words,
the Safe Extension API protects applications from careless extension
developers. As long as all used extensions are safe, it is not possible that a
combination of extensions  (the developers of which did not know about each
other) impedes the security of the base MLS protocol or any used extension. No
further analysis of the combination is necessary. This also means that any
security vulnerabilities introduced by one extension do not spread to other
extensions or the base MLS.<a href="#section-2.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="core-struct-extensions">
<section id="section-2.1.2">
          <h4 id="name-core-struct-extensions">
<a href="#section-2.1.2" class="section-number selfRef">2.1.2. </a><a href="#name-core-struct-extensions" class="section-name selfRef">Core Struct Extensions</a>
          </h4>
<p id="section-2.1.2-1">Every type of MLS extension can have data associated with it. The "MLS
Extensions Types" registry historically represented extensibility of four
core structs (<code>GroupContext</code>, <code>GroupInfo</code>, <code>KeyPackage</code>, and <code>LeafNode</code>)
that have far reaching effects on the use of the protocol. The majority of
MLS extensions registered at the time of this writing extend one or more
of these core structs.<a href="#section-2.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1.2-2.1">
              <p id="section-2.1.2-2.1.1">GroupContext Extensions: Any data in a group context extension is agreed-upon
by all members of the group in the same way as the rest of the group state. As
part of the GroupContext, it is also sent encrypted to new joiners via Welcome
messages and (depending on the architecture of the application) may be
available to external joiners. Note that in some scenarios, the GroupContext
may also be visible to components  that implement the delivery service. While
MLS extensions can define arbitrary GroupContext extensions, it is recommended
to make use of <code>ExtensionState</code> extensions to store state in the group's
GroupContext.<a href="#section-2.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.2-2.2">
              <p id="section-2.1.2-2.2.1">GroupInfo Extensions: GroupInfo extensions are included in the GroupInfo
struct and thus sent encrypted and authenticated by the signer of the
GroupInfo to new joiners as part of Welcome messages. It can thus be used as a
confidential and authenticated channel from the inviting group member to new
joiners. Just like GroupContext extensions, they may also be visible to
external joiners or even parts of the delivery service. Unlike GroupContext
extensions, the GroupInfo struct is not part of the group state that all group
members agree on.<a href="#section-2.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.2-2.3">
              <p id="section-2.1.2-2.3.1">KeyPackage Extensions: KeyPackages (and the extensions they include) are
pre-published by individual clients for asynchronous group joining. They are
included in Add proposals and become part of the group state once the Add
proposal is committed. They are, however, removed from the group state when
the owner of the KeyPackage does the first commit with a path. As such,
KeyPackage extensions can be used to communicate data to anyone who wants to
invite the owner to a group, as well as the other members of the group the
owner is added to. Note that KeyPackage extensions are visible to the server
that provides the KeyPackages for download, as well as any part of the
delivery service that can see the public group state.<a href="#section-2.1.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.2-2.4">
              <p id="section-2.1.2-2.4.1">LeafNode Extensions: LeafNodes are a part of every KeyPackage and thus follow
the same lifecycle. However, they are also part of any commit that includes an
UpdatePath and clients generally have a leaf node in each group they are a member
of. Leaf node extensions can thus be used to include member-specific data in a
group state that can be updated by the owner at any time.<a href="#section-2.1.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="common-data-structures">
<section id="section-2.1.3">
          <h4 id="name-common-data-structures">
<a href="#section-2.1.3" class="section-number selfRef">2.1.3. </a><a href="#name-common-data-structures" class="section-name selfRef">Common Data Structures</a>
          </h4>
<p id="section-2.1.3-1">The Safe Extension API reuses the <code>ExtensionType</code> and the "MLS Extension
Types" IANA registry used for these core structs (see Section 17.3 of
<span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span>), even for safe extensions with no core struct changes.
This is because many extensions modify a core struct, either primarily or
to store state (related to the group or a client) associated with another
aspect of that extension.<a href="#section-2.1.3-1" class="pilcrow">¶</a></p>
<p id="section-2.1.3-2">Most Safe Extension API components also use the following data structure, which
provides domain separation by <code>extension_type</code> of various <code>extension_data</code>.<a href="#section-2.1.3-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.3-3">
<pre>
struct {
  ExtensionType extension_type;
  opaque extension_data&lt;V&gt;;
} ExtensionContent;
</pre><a href="#section-2.1.3-3" class="pilcrow">¶</a>
</div>
<p id="section-2.1.3-4">Where <code>extension_type</code> is set to the type of the extension to which the
<code>extension_data</code> belongs.<a href="#section-2.1.3-4" class="pilcrow">¶</a></p>
<p id="section-2.1.3-5">When a label is required for an extension, the following data structure is
used.<a href="#section-2.1.3-5" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.3-6">
<pre>
struct {
  opaque label;
  ExtensionContent extension_content;
} LabeledExtensionContent;
</pre><a href="#section-2.1.3-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="negotiating-support-for-safe-extensions">
<section id="section-2.1.4">
          <h4 id="name-negotiating-support-for-saf">
<a href="#section-2.1.4" class="section-number selfRef">2.1.4. </a><a href="#name-negotiating-support-for-saf" class="section-name selfRef">Negotiating Support for Safe Extensions</a>
          </h4>
<p id="section-2.1.4-1">MLS defines a <code>Capabilities</code> struct for LeafNodes (in turn used in
KeyPackages), which describes which extensions are supported by the
associated node.
However, that struct (defined in Section 7.2 of <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span>) only has
fields for a subset of the extensions possible in MLS, as reproduced below.<a href="#section-2.1.4-1" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.4-2">
<pre>
...
struct {
    ProtocolVersion versions&lt;V&gt;;
    CipherSuite cipher_suites&lt;V&gt;;
    ExtensionType extensions&lt;V&gt;;
    ProposalType proposals&lt;V&gt;;
    CredentialType credentials&lt;V&gt;;
} Capabilities;
...
</pre><a href="#section-2.1.4-2" class="pilcrow">¶</a>
</div>
<p id="section-2.1.4-3">Therefore, all safe extensions MUST be represented by their <code>extension_type</code>
in the <code>extensions</code> vector (originally intended for core struct extensions),
regardless of their type.<a href="#section-2.1.4-3" class="pilcrow">¶</a></p>
<p id="section-2.1.4-4">If the LeafNode supports any safe extension Credentials, the <code>credentials</code>
vector will contain any non-safe credentials supported, plus the <code>extension_credential</code> defined in {extension-credential}.<a href="#section-2.1.4-4" class="pilcrow">¶</a></p>
<p id="section-2.1.4-5">If the LeafNode supports any safe extension Proposals, then <code>proposals</code> will
contain any non-default non-safe extensions, and whichever safe extension
proposal types defined in {mls-proposal-types} are relevant to the supported
safe proposals.<a href="#section-2.1.4-5" class="pilcrow">¶</a></p>
<p id="section-2.1.4-6">Likewise, the <code>required_capabilities</code> GroupContext extension (defined
in Section 11.1 of <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span> and reproduced below) contains all
mandatory to support non-default non-safe, and safe extensions in its
<code>extension_types</code> vector. Its <code>credential_types</code> vector contains any
mandatory non-safe credential types, plus <code>extensions_credential</code> if any
safe credential is required. Its <code>proposal_types</code> vector contains any
mandatory to support non-default non-safe Proposals, and the relevant safe
proposal type or types corresponding to any required safe proposals.<a href="#section-2.1.4-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.1.4-7">
<pre>
struct {
    ExtensionType extension_types&lt;V&gt;;
    ProposalType proposal_types&lt;V&gt;;
    CredentialType credential_types&lt;V&gt;;
} RequiredCapabilities;
</pre><a href="#section-2.1.4-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="safe-hpke">
<section id="section-2.1.5">
          <h4 id="name-hybrid-public-key-encryptio">
<a href="#section-2.1.5" class="section-number selfRef">2.1.5. </a><a href="#name-hybrid-public-key-encryptio" class="section-name selfRef">Hybrid Public Key Encryption (HPKE)</a>
          </h4>
<p id="section-2.1.5-1">This component of the Safe Extension API allows extensions to make use of all
HPKE key pairs generated by MLS. An extension identified by an ExtensionType can
use any HPKE key pair for any operation defined in <span>[<a href="#RFC9180" class="cite xref">RFC9180</a>]</span>, such as
encryption, exporting keys and the PSK mode, as long as the <code>info</code> input to
<code>Setup&lt;MODE&gt;S</code> and <code>Setup&lt;MODE&gt;R</code> is set to LabeledExtensionContent with
<code>extension_type</code> set to ExtensionType. The <code>extension_data</code> can be set to an
arbitrary Context specified by the extension designer (and can be empty if not
needed). For example, an extension can use a key pair PublicKey, PrivateKey to
encrypt data as follows:<a href="#section-2.1.5-1" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.5-2">
<pre>
SafeEncryptWithContext(ExtensionType, PublicKey, Context, Plaintext) =
    SealBase(PublicKey, LabeledExtensionContent, "", Plaintext)

SafeDecryptWithContext(ExtensionType, PrivateKey, Context, KEMOutput, Ciphertext) =
    OpenBase(KEMOutput, PrivateKey, LabeledExtensionContent, "", Ciphertext)
</pre><a href="#section-2.1.5-2" class="pilcrow">¶</a>
</div>
<p id="section-2.1.5-3">Where the fields of LabeledExtensionContent are set to<a href="#section-2.1.5-3" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.5-4">
<pre>
label = "MLS 1.0 ExtensionData"
extension_type = ExtensionType
extension_data = Context
</pre><a href="#section-2.1.5-4" class="pilcrow">¶</a>
</div>
<p id="section-2.1.5-5">For operations involving the secret key, ExtensionType MUST be set to the
ExtensionType of the implemented extension, and not to the type of any other
extension. In particular, this means that an extension cannot decrypt data meant
for another extension, while extensions can encrypt data to other extensions.<a href="#section-2.1.5-5" class="pilcrow">¶</a></p>
<p id="section-2.1.5-6">In general, a ciphertext encrypted with a PublicKey can be decrypted by any
entity who has the corresponding PrivateKey at a given point in time according
to the MLS protocol (or extension). For convenience, the following list
summarizes lifetimes of MLS key pairs.<a href="#section-2.1.5-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1.5-7.1">
              <p id="section-2.1.5-7.1.1">The key pair of a non-blank ratchet tree node. The PrivateKey of such a key pair
is known to all members in the node’s subtree. In particular, a PrivateKey of a
leaf node is known only to the member in that leaf. A member in the subtree
stores the PrivateKey for a number of epochs, as long as the PublicKey does not
change. The key pair of the root node SHOULD NOT be used, since the external key
pair recalled below gives better security.<a href="#section-2.1.5-7.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.5-7.2">
              <p id="section-2.1.5-7.2.1">The external_priv, external_pub key pair used for external initialization. The
external_priv key is known to all group members in the current epoch. A member
stores external_priv only for the current epoch. Using this key pair gives
better security guarantees than using the key pair of the root of the ratchet
tree and should always be preferred.<a href="#section-2.1.5-7.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.5-7.3">
              <p id="section-2.1.5-7.3.1">The init_key in a KeyPackage and the corresponding secret key. The secret key
is known only to the owner of the KeyPackage and is deleted immediately after it
is used to join a group.<a href="#section-2.1.5-7.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="signature-keys">
<section id="section-2.1.6">
          <h4 id="name-signature-keys">
<a href="#section-2.1.6" class="section-number selfRef">2.1.6. </a><a href="#name-signature-keys" class="section-name selfRef">Signature Keys</a>
          </h4>
<p id="section-2.1.6-1">MLS session states contain a number of signature keys including the ones in the
LeafNode structs. Extensions can safely sign content and verify signatures using
these keys via the SafeSignWithLabel and SafeVerifyWithLabel functions,
respectively, much like how the basic MLS protocol uses SignWithLabel and
VerifyWithLabel.<a href="#section-2.1.6-1" class="pilcrow">¶</a></p>
<p id="section-2.1.6-2">In more detail, an extension identified by ExtensionType should sign and verify using:<a href="#section-2.1.6-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.6-3">
<pre>
SafeSignWithLabel(ExtensionType, SignatureKey, Label, Content) =
    SignWithLabel(SignatureKey, "LabeledExtensionContent", LabeledExtensionContent)

SafeVerifyWithLabel(ExtensionType, VerificationKey, Label, Content, SignatureValue) =
    VerifyWithLabel(VerificationKey, "LabeledExtensionContent", LabeledExtensionContent, SignatureValue)
</pre><a href="#section-2.1.6-3" class="pilcrow">¶</a>
</div>
<p id="section-2.1.6-4">Where the fields of LabeledExtensionContent are set to<a href="#section-2.1.6-4" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.6-5">
<pre>
label = Label
extension_type = ExtensionType
extension_data = Content
</pre><a href="#section-2.1.6-5" class="pilcrow">¶</a>
</div>
<p id="section-2.1.6-6">For signing operations, the ExtensionType MUST be set to the ExtensionType of
the implemented extension, and not to the type of any other extension. In
particular, this means that an extension cannot produce signatures in place of
other extensions. However, extensions can verify signatures computed by other
extensions. Note that domain separation is ensured by explicitly including the
ExtensionType with every operation.<a href="#section-2.1.6-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="exporting-secrets">
<section id="section-2.1.7">
          <h4 id="name-exporting-secrets">
<a href="#section-2.1.7" class="section-number selfRef">2.1.7. </a><a href="#name-exporting-secrets" class="section-name selfRef">Exporting Secrets</a>
          </h4>
<p id="section-2.1.7-1">An extension can use MLS as a group key agreement protocol by exporting symmetric keys.
Such keys can be exported (i.e. derived from MLS key material) in two phases per
epoch: Either at the start of the epoch, or during the epoch. Derivation at the
start of the epoch has the added advantage that the source key material is
deleted after use, allowing the derived key material to be deleted later even
during the same MLS epoch to achieve forward secrecy. The following protocol
secrets can be used to derive key from for use by extensions:<a href="#section-2.1.7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1.7-2.1">
              <p id="section-2.1.7-2.1.1">epoch_secret at the beginning of an epoch<a href="#section-2.1.7-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.7-2.2">
              <p id="section-2.1.7-2.2.1">extension_secret during an epoch<a href="#section-2.1.7-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.1.7-3">The extension_secret is an additional secret derived from the epoch_secret at
the beginning of the epoch in the same way as the other secrets listed in Table
4 of <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span> using the label "extension".<a href="#section-2.1.7-3" class="pilcrow">¶</a></p>
<p id="section-2.1.7-4">Any derivation performed by an extension either from the epoch_secret or the
extension_secret has to use the following function:<a href="#section-2.1.7-4" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.7-5">
<pre>
DeriveExtensionSecret(Secret, Label) =
  ExpandWithLabel(Secret, "ExtensionExport " + ExtensionType + " " + Label)
</pre><a href="#section-2.1.7-5" class="pilcrow">¶</a>
</div>
<p id="section-2.1.7-6">Where ExpandWithLabel is defined in Section 8 of <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span> and where ExtensionType
MUST be set to the ExtensionType of the implemented extension.<a href="#section-2.1.7-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pre-shared-keys-psks">
<section id="section-2.1.8">
          <h4 id="name-pre-shared-keys-psks">
<a href="#section-2.1.8" class="section-number selfRef">2.1.8. </a><a href="#name-pre-shared-keys-psks" class="section-name selfRef">Pre-Shared Keys (PSKs)</a>
          </h4>
<p id="section-2.1.8-1">PSKs represent key material that is injected into the MLS key schedule when
creating or processing a commit as defined in Section 8.4 of <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span>. Its
injection into the key schedule means that all group members have to agree on
the value of the PSK.<a href="#section-2.1.8-1" class="pilcrow">¶</a></p>
<p id="section-2.1.8-2">While PSKs are typically cryptographic keys which due to their properties add to
the overall security of the group, the PSK mechanism can also be used to ensure
that all members of a group agree on arbitrary pieces of data represented as
octet strings (without the necessity of sending the data itself over the wire).
For example, an extension can use the PSK mechanism to enforce that all group
members have access to and agree on a password or a shared file.<a href="#section-2.1.8-2" class="pilcrow">¶</a></p>
<p id="section-2.1.8-3">This is achieved by creating a new epoch via a PSK proposal. Transitioning to
the new epoch requires using the information agreed upon.<a href="#section-2.1.8-3" class="pilcrow">¶</a></p>
<p id="section-2.1.8-4">To facilitate using PSKs in a safe way, this document defines a new PSKType for
extensions. This provides domain separation between pre-shared keys used by the
core MLS protocol and applications, and between those used by different extensions.<a href="#section-2.1.8-4" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.8-5">
<pre>
enum {
  reserved(0),
  external(1),
  resumption(2),
  extensions(3),
  (255)
} PSKType;

struct {
  PSKType psktype;
  select (PreSharedKeyID.psktype) {
    case external:
      opaque psk_id&lt;V&gt;;

    case resumption:
      ResumptionPSKUsage usage;
      opaque psk_group_id&lt;V&gt;;
      uint64 psk_epoch;

    case extensions:
      ExtensionType extension_type;
      opaque psk_id&lt;V&gt;;
  };
  opaque psk_nonce&lt;V&gt;;
} PreSharedKeyID;
</pre><a href="#section-2.1.8-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="extension-designer-tools">
<section id="section-2.1.9">
          <h4 id="name-extension-designer-tools">
<a href="#section-2.1.9" class="section-number selfRef">2.1.9. </a><a href="#name-extension-designer-tools" class="section-name selfRef">Extension Designer Tools</a>
          </h4>
<p id="section-2.1.9-1">The safe extension API allows extension designers to sign and encrypt payloads
without the need to register their own IANA labels. Following the same pattern,
this document also provides ways for extension designers to define their own
wire formats, proposals, credentials, and for structured data in the
Additional Authenticated Data.<a href="#section-2.1.9-1" class="pilcrow">¶</a></p>
<div id="core-struct-extensions-1">
<section id="section-2.1.9.1">
            <h5 id="name-core-struct-extensions-2">
<a href="#section-2.1.9.1" class="section-number selfRef">2.1.9.1. </a><a href="#name-core-struct-extensions-2" class="section-name selfRef">Core Struct Extensions</a>
            </h5>
<p id="section-2.1.9.1-1">Each extension of the GroupContext, GroupInfo, KeyPackage, and/or LeafNode
structs is required to define the format of its data. These types of
extensions SHOULD NOT use the <code>ExtensionContent</code> struct since the <code>extension_type</code> is already in the parent data structure.<a href="#section-2.1.9.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wire-formats">
<section id="section-2.1.9.2">
            <h5 id="name-wire-formats">
<a href="#section-2.1.9.2" class="section-number selfRef">2.1.9.2. </a><a href="#name-wire-formats" class="section-name selfRef">Wire Formats</a>
            </h5>
<p id="section-2.1.9.2-1">Extensions can define their own MLS messages by using the mls_extension_message
MLS Wire Format. The mls_extension_message Wire Format is IANA registered
specifically for this purpose and extends the select statement in the MLSMessage
struct as follows:<a href="#section-2.1.9.2-1" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.9.2-2">
<pre>
case mls_extension_message:
    ExtensionContent extension_content;
</pre><a href="#section-2.1.9.2-2" class="pilcrow">¶</a>
</div>
<p id="section-2.1.9.2-3">The extension_type in <code>extension_content</code> MUST be set to the type of the
extension in question.
Processing of self-defined wire formats has to be defined by the extension.<a href="#section-2.1.9.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="proposals">
<section id="section-2.1.9.3">
            <h5 id="name-proposals">
<a href="#section-2.1.9.3" class="section-number selfRef">2.1.9.3. </a><a href="#name-proposals" class="section-name selfRef">Proposals</a>
            </h5>
<p id="section-2.1.9.3-1">Similar to wire formats, extensions can define their own proposals by using one
of three dedicated extension proposal types: extension_proposal,
extension_path_proposal and extension_external_propsal. Each type contains the
same ExtensionContent struct, but is validated differently: extension_proposal
requires no UpdatePath and can not be sent by an external sender
extension_path_proposal requires an UpdatePath and can not be sent by an external
sender extensions_external_proposal requires no UpdatePath and can be sent by an
external sender.<a href="#section-2.1.9.3-1" class="pilcrow">¶</a></p>
<p id="section-2.1.9.3-2">Each of the three proposal types is IANA registered and extends the select
statement in the Proposal struct as follows:<a href="#section-2.1.9.3-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.9.3-3">
<pre>
case extension_proposal:
    ExtensionContent extension_content;
case extension_path_proposal:
    ExtensionContent extension_content;
case extension_external_proposal:
    ExtensionContent extension_content;
</pre><a href="#section-2.1.9.3-3" class="pilcrow">¶</a>
</div>
<p id="section-2.1.9.3-4">The extension_type MUST be set to the type of the extension in question.<a href="#section-2.1.9.3-4" class="pilcrow">¶</a></p>
<p id="section-2.1.9.3-5">Processing and validation of self-defined proposals has to be defined by the
extension. However, validation rules can lead to a previously valid commit to
become invalid, not the other way around. This is with the exception of proposal
validation for external commits, where self-defined proposals can be declared
valid for use in external commits. More concretely, if an external commit is
invalid, only because the self-defined proposal is part of it (the last rule in
external commit proposal validation in Section 12.2 of <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span>), then the
self-defined validation rules may rule that the commit is instead valid.<a href="#section-2.1.9.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="credentials">
<section id="section-2.1.9.4">
            <h5 id="name-credentials">
<a href="#section-2.1.9.4" class="section-number selfRef">2.1.9.4. </a><a href="#name-credentials" class="section-name selfRef">Credentials</a>
            </h5>
<p id="section-2.1.9.4-1">Extension designers can also define their own credential types via the IANA
registered extension_credential credential type. The extension_credential
extends the select statement in the Credential struct as follows:<a href="#section-2.1.9.4-1" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.9.4-2">
<pre>
case extension_credential:
    ExtensionContent extension_content;
</pre><a href="#section-2.1.9.4-2" class="pilcrow">¶</a>
</div>
<p id="section-2.1.9.4-3">The extension_type in the extension_content must be set to that of the extension
in question  with the extension_data containing all other relevant data. Note
that any credential defined in this way has to meet the requirements detailed in
Section 5.3 of the MLS specification.<a href="#section-2.1.9.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="safe-aad">
<section id="section-2.1.9.5">
            <h5 id="name-additional-authenticated-da">
<a href="#section-2.1.9.5" class="section-number selfRef">2.1.9.5. </a><a href="#name-additional-authenticated-da" class="section-name selfRef">Additional Authenticated Data (AAD)</a>
            </h5>
<p id="section-2.1.9.5-1">The <code>PrivateContentAAD</code> struct in MLS can contain arbitrary additional
application-specific AAD in its <code>authenticated_data</code> field. This framework
defines a framing used to allow multiple extensions to add AAD safely
without conflicts or ambiguity.<a href="#section-2.1.9.5-1" class="pilcrow">¶</a></p>
<p id="section-2.1.9.5-2">When any AAD safe extension is included in the <code>authenticated_data</code> field,
the "safe" AAD items MUST come before any non-safe data in the
<code>authenticated_data</code> field. Safe AAD items are framed using the <code>SafeAAD</code>
struct and are sorted in increasing numerical order of the <code>ExtensionType</code>
as described below:<a href="#section-2.1.9.5-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.9.5-3">
<pre>
struct {
  ExtensionType extension_type;
  opaque aad_item_data&lt;V&gt;;
} SafeAADItem;

struct {
  SafeAADItem aad_items&lt;V&gt;;
} SafeAAD;
</pre><a href="#section-2.1.9.5-3" class="pilcrow">¶</a>
</div>
<p id="section-2.1.9.5-4">If the <code>SafeAAD</code> is present or not is determined by the presence of the
<code>extension_aad</code> GroupContext extension in the <code>required_capabilities</code> of the
group. If <code>extension_aad</code> is present in <code>required_capabilities</code> but no
"safe" AAD items are present, the <code>aad_items</code> is a zero-length vector.<a href="#section-2.1.9.5-4" class="pilcrow">¶</a></p>
<p id="section-2.1.9.5-5">Each extension which include a <code>SafeAADItem</code> needs to advertise its
<code>ExtensionType</code> in its LeafNode <code>capabilities.extensions</code>. Extensions MAY
require an <code>ExtensionType</code> to be included in <code>required_capabilities</code>, but
members which encounter a <code>SafeAADItem</code> they do not recognize can safely
ignore it.<a href="#section-2.1.9.5-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="extension-state-anchoring-storage-and-agreement">
<section id="section-2.1.10">
          <h4 id="name-extension-state-anchoring-s">
<a href="#section-2.1.10" class="section-number selfRef">2.1.10. </a><a href="#name-extension-state-anchoring-s" class="section-name selfRef">Extension state: anchoring, storage and agreement</a>
          </h4>
<p id="section-2.1.10-1">The safe extension framework can help an MLS extension ensure that all group
members agree on a piece of extension-specific state by using the
<code>ExtensionState</code> GroupContext extension. The ownership of an <code>ExtensionState</code>
extension in the context of the safe extension framework is determined by the
<code>extension_type</code> field. The extension with a matching <code>extension_type</code> is called
the owning extension.<a href="#section-2.1.10-1" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-2.1.10-2">
<pre>
enum {
  reserved(0),
  read(1),
  none(2),
 (255)
} Permissions;

enum {
  reserved(0),
  hash(1),
  data(2),
} HashOrData;

struct {
  HashOrData hash_or_data;
  select(hash_or_data) {
    case hash:
      HashReference state_hash;
    case data:
      opaque state&lt;V&gt;;
  }
} ExtensionPayload;

struct {
  extensionType extension_type;
  Permissions read;
  ExtensionPayload payload;
} ExtensionState;
</pre><a href="#section-2.1.10-2" class="pilcrow">¶</a>
</div>
<p id="section-2.1.10-3">The <code>ExtensionState</code> GroupContext extension contains data either directly (if
<code>hash_or_data = data</code>) or inditectly via a hash (if <code>hash_or_data = hash</code>).<a href="#section-2.1.10-3" class="pilcrow">¶</a></p>
<p id="section-2.1.10-4">The owning extension can read and write the state stored in an <code>ExtensionState</code>
extension using an extension-defined proposal (see <a href="#proposals" class="auto internal xref">Section 2.1.9.3</a>). The semantics
of the proposal determines how the state is changed.<a href="#section-2.1.10-4" class="pilcrow">¶</a></p>
<p id="section-2.1.10-5">The <code>read</code> variable determines the permissions that other MLS extensions have
w.r.t. the data stored within. <code>read</code> allows other MLS extensions to read that
data via their own proposals, while <code>none</code> marks the data as private to the
owning MLS extension.<a href="#section-2.1.10-5" class="pilcrow">¶</a></p>
<p id="section-2.1.10-6">Other extensions may never write to the <code>ExtensionState</code> of the owning MLS
extension.<a href="#section-2.1.10-6" class="pilcrow">¶</a></p>
<div id="direct-vs-hash-based-storage">
<section id="section-2.1.10.1">
            <h5 id="name-direct-vs-hash-based-storag">
<a href="#section-2.1.10.1" class="section-number selfRef">2.1.10.1. </a><a href="#name-direct-vs-hash-based-storag" class="section-name selfRef">Direct vs. hash-based storage</a>
            </h5>
<p id="section-2.1.10.1-1">Storing the data directly in the <code>ExtensionState</code> means the data becomes part of
the group state. Depending on the application design, this can be advantageous,
because it is distributed via Welcome messages. However, it could also mean that
the data is visible to the delivery service. Additionally, if the application
makes use of GroupContextExtension proposals, it may be necessary to send all of
the data with each such extension.<a href="#section-2.1.10.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1.10.1-2">Including the data by hash only allows group members to agree on the data
indirectly, relying on the collision resistance of the associated hash function.
The data itself, however, may have to be transmitted out-of-band to new joiners.<a href="#section-2.1.10.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="groupcontextextensions">
<section id="section-2.1.10.2">
            <h5 id="name-groupcontextextensions">
<a href="#section-2.1.10.2" class="section-number selfRef">2.1.10.2. </a><a href="#name-groupcontextextensions" class="section-name selfRef">GroupContextExtensions</a>
            </h5>
<p id="section-2.1.10.2-1">MLS allows applications to modify GroupContext extensions via the
GroupContextExtension proposal. However, control via that proposal involves
including all GroupContext extensions in each such proposal. This makes data
management more costly than via extension-specific proposals, which can, for
example, include only the data to be changed for a given GroupContext extension,
or define semantics that allow modification based on local data only.<a href="#section-2.1.10.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="extension-design-guidance">
<section id="section-2.2">
        <h3 id="name-extension-design-guidance">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-extension-design-guidance" class="section-name selfRef">Extension Design Guidance</a>
        </h3>
<p id="section-2.2-1">While extensions can modify the protocol flow of MLS and the associated
properties in arbitrary ways, the base MLS protocol already enables a number of
functionalities that extensions can use without modifying MLS itself. Extension
authors should consider using these built-in mechanisms before employing more
intrusive changes to the protocol.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="extensions">
<section id="section-3">
      <h2 id="name-extensions">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-extensions" class="section-name selfRef">Extensions</a>
      </h2>
<div id="appack">
<section id="section-3.1">
        <h3 id="name-appack">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-appack" class="section-name selfRef">AppAck</a>
        </h3>
<p id="section-3.1-1">Type: Proposal<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div id="description">
<section id="section-3.1.1">
          <h4 id="name-description">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-description" class="section-name selfRef">Description</a>
          </h4>
<p id="section-3.1.1-1">An AppAck proposal is used to acknowledge receipt of application messages.
Though this information implies no change to the group, it is structured as a
Proposal message so that it is included in the group's transcript by being
included in Commit messages.<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.1.1-2">
<pre>
struct {
    uint32 sender;
    uint32 first_generation;
    uint32 last_generation;
} MessageRange;

struct {
    MessageRange received_ranges&lt;V&gt;;
} AppAck;
</pre><a href="#section-3.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.1.1-3">An AppAck proposal represents a set of messages received by the sender in the
current epoch.  Messages are represented by the <code>sender</code> and <code>generation</code> values
in the MLSCiphertext for the message.  Each MessageRange represents receipt of a
span of messages whose <code>generation</code> values form a continuous range from
<code>first_generation</code> to <code>last_generation</code>, inclusive.<a href="#section-3.1.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1.1-4">AppAck proposals are sent as a guard against the Delivery Service dropping
application messages.  The sequential nature of the <code>generation</code> field provides
a degree of loss detection, since gaps in the <code>generation</code> sequence indicate
dropped messages.  AppAck completes this story by addressing the scenario where
the Delivery Service drops all messages after a certain point, so that a later
generation is never observed.  Obviously, there is a risk that AppAck messages
could be suppressed as well, but their inclusion in the transcript means that if
they are suppressed then the group cannot advance at all.<a href="#section-3.1.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1.1-5">The schedule on which sending AppAck proposals are sent is up to the application,
and determines which cases of loss/suppression are detected.  For example:<a href="#section-3.1.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1.1-6.1">
              <p id="section-3.1.1-6.1.1">The application might have the committer include an AppAck proposal whenever a
Commit is sent, so that other members could know when one of their messages
did not reach the committer.<a href="#section-3.1.1-6.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.1.1-6.2">
              <p id="section-3.1.1-6.2.1">The application could have a client send an AppAck whenever an application
message is sent, covering all messages received since its last AppAck.  This
would provide a complete view of any losses experienced by active members.<a href="#section-3.1.1-6.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.1.1-6.3">
              <p id="section-3.1.1-6.3.1">The application could simply have clients send AppAck proposals on a timer, so
that all participants' state would be known.<a href="#section-3.1.1-6.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-3.1.1-7">An application using AppAck proposals to guard against loss/suppression of
application messages also needs to ensure that AppAck messages and the Commits
that reference them are not dropped.  One way to do this is to always encrypt
Proposal and Commit messages, to make it more difficult for the Delivery Service
to recognize which messages contain AppAcks.  The application can also have
clients enforce an AppAck schedule, reporting loss if an AppAck is not received
at the expected time.<a href="#section-3.1.1-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="targeted-messages">
<section id="section-3.2">
        <h3 id="name-targeted-messages">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-targeted-messages" class="section-name selfRef">Targeted messages</a>
        </h3>
<div id="description-1">
<section id="section-3.2.1">
          <h4 id="name-description-2">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-description-2" class="section-name selfRef">Description</a>
          </h4>
<p id="section-3.2.1-1">MLS application messages make sending encrypted messages to all group members
easy and efficient. Sometimes application protocols mandate that messages are
only sent to specific group members, either for privacy or for efficiency
reasons.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
<p id="section-3.2.1-2">Targeted messages are a way to achieve this without having to create a new group
with the sender and the specific recipients – which might not be possible or
desired. Instead, targeted messages define the format and encryption of a
message that is sent from a member of an existing group to another member of
that group.<a href="#section-3.2.1-2" class="pilcrow">¶</a></p>
<p id="section-3.2.1-3">The goal is to provide a one-shot messaging mechanism that provides
confidentiality and authentication.<a href="#section-3.2.1-3" class="pilcrow">¶</a></p>
<p id="section-3.2.1-4">Targeted Messages makes use the Safe Extension API as defined in <a href="#safe-extension-api" class="auto internal xref">Section 2.1</a>.
reuse mechanisms from <span>[<a href="#mls-protocol" class="cite xref">mls-protocol</a>]</span>, in particular <span>[<a href="#hpke" class="cite xref">hpke</a>]</span>.<a href="#section-3.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="format">
<section id="section-3.2.2">
          <h4 id="name-format">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-format" class="section-name selfRef">Format</a>
          </h4>
<p id="section-3.2.2-1">This extension uses the <code>mls_extension_message</code> WireFormat as defined in Section
<a href="#wire-formats" class="auto internal xref">Section 2.1.9.2</a>, where the content is a <code>TargetedMessage</code>.<a href="#section-3.2.2-1" class="pilcrow">¶</a></p>
<div class="breakable lang-tls sourcecode" id="section-3.2.2-2">
<pre>
struct {
  opaque group_id&lt;V&gt;;
  uint64 epoch;
  uint32 recipient_leaf_index;
  opaque authenticated_data&lt;V&gt;;
  opaque encrypted_sender_auth_data&lt;V&gt;;
  opaque hpke_ciphertext&lt;V&gt;;
} TargetedMessage;

enum {
  hpke_auth_psk(0),
  signature_hpke_psk(1),
} TargetedMessageAuthScheme;

struct {
  uint32 sender_leaf_index;
  TargetedMessageAuthScheme authentication_scheme;
  select (authentication_scheme) {
    case HPKEAuthPsk:
    case SignatureHPKEPsk:
      opaque signature&lt;V&gt;;
  }
  opaque kem_output&lt;V&gt;;
} TargetedMessageSenderAuthData;

struct {
  opaque group_id&lt;V&gt;;
  uint64 epoch;
  uint32 recipient_leaf_index;
  opaque authenticated_data&lt;V&gt;;
  TargetedMessageSenderAuthData sender_auth_data;
} TargetedMessageTBM;

struct {
  opaque group_id&lt;V&gt;;
  uint64 epoch;
  uint32 recipient_leaf_index;
  opaque authenticated_data&lt;V&gt;;
  uint32 sender_leaf_index;
  TargetedMessageAuthScheme authentication_scheme;
  opaque kem_output&lt;V&gt;;
  opaque hpke_ciphertext&lt;V&gt;;
} TargetedMessageTBS;

struct {
  opaque group_id&lt;V&gt;;
  uint64 epoch;
  opaque label&lt;V&gt; = "MLS 1.0 targeted message psk";
} PSKId;
</pre><a href="#section-3.2.2-2" class="pilcrow">¶</a>
</div>
<p id="section-3.2.2-3">Note that <code>TargetedMessageTBS</code> is only used with the
<code>TargetedMessageAuthScheme.SignatureHPKEPsk</code> authentication mode.<a href="#section-3.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="encryption">
<section id="section-3.2.3">
          <h4 id="name-encryption">
<a href="#section-3.2.3" class="section-number selfRef">3.2.3. </a><a href="#name-encryption" class="section-name selfRef">Encryption</a>
          </h4>
<p id="section-3.2.3-1">Targeted messages uses HPKE to encrypt the message content between two leaves.<a href="#section-3.2.3-1" class="pilcrow">¶</a></p>
<div id="sender-data-encryption">
<section id="section-3.2.3.1">
            <h5 id="name-sender-data-encryption">
<a href="#section-3.2.3.1" class="section-number selfRef">3.2.3.1. </a><a href="#name-sender-data-encryption" class="section-name selfRef">Sender data encryption</a>
            </h5>
<p id="section-3.2.3.1-1">In addition, <code>TargetedMessageSenderAuthData</code> is encrypted in a similar way to
<code>MLSSenderData</code> as described in section 6.3.2 in <span>[<a href="#mls-protocol" class="cite xref">mls-protocol</a>]</span>. The
<code>TargetedMessageSenderAuthData.sender_leaf_index</code> field is the leaf index of the
sender. The <code>TargetedMessageSenderAuthData.authentication_scheme</code> field is the
authentication scheme used to authenticate the sender. The
<code>TargetedMessageSenderAuthData.signature</code> field is the signature of the
<code>TargetedMessageTBS</code> structure. The <code>TargetedMessageSenderAuthData.kem_output</code>
field is the KEM output of the HPKE encryption.<a href="#section-3.2.3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.2.3.1-2">The key and nonce provided to the AEAD are computed as the KDF of the first
KDF.Nh bytes of the <code>hpke_ciphertext</code> generated in the following section. If the
length of the hpke_ciphertext is less than KDF.Nh, the whole hpke_ciphertext is
used. In pseudocode, the key and nonce are derived as:<a href="#section-3.2.3.1-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.2.3.1-3">
<pre>
sender_auth_data_secret
  = DeriveExtensionSecret(extension_secret, "targeted message sender auth data")

ciphertext_sample = hpke_ciphertext[0..KDF.Nh-1]

sender_data_key = ExpandWithLabel(sender_auth_data_secret, "key",
                      ciphertext_sample, AEAD.Nk)
sender_data_nonce = ExpandWithLabel(sender_auth_data_secret, "nonce",
                      ciphertext_sample, AEAD.Nn)
</pre><a href="#section-3.2.3.1-3" class="pilcrow">¶</a>
</div>
<p id="section-3.2.3.1-4">The Additional Authenticated Data (AAD) for the <code>SenderAuthData</code> ciphertext is
the first three fields of <code>TargetedMessage</code>:<a href="#section-3.2.3.1-4" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.2.3.1-5">
<pre>
struct {
  opaque group_id&lt;V&gt;;
  uint64 epoch;
  uint32 recipient_leaf_index;
} SenderAuthDataAAD;
</pre><a href="#section-3.2.3.1-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="padding">
<section id="section-3.2.3.2">
            <h5 id="name-padding">
<a href="#section-3.2.3.2" class="section-number selfRef">3.2.3.2. </a><a href="#name-padding" class="section-name selfRef">Padding</a>
            </h5>
<p id="section-3.2.3.2-1">The <code>TargetedMessage</code> structure does not include a padding field. It is the
responsibility of the sender to add padding to the <code>message</code> as used in the next
section.<a href="#section-3.2.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="authentication">
<section id="section-3.2.4">
          <h4 id="name-authentication">
<a href="#section-3.2.4" class="section-number selfRef">3.2.4. </a><a href="#name-authentication" class="section-name selfRef">Authentication</a>
          </h4>
<p id="section-3.2.4-1">For ciphersuites that support it, HPKE <code>mode_auth_psk</code> is used for
authentication. For other ciphersuites, HPKE <code>mode_psk</code> is used along with a
signature. The authentication scheme is indicated by the <code>authentication_scheme</code>
field in <code>TargetedMessageContent</code>. See <a href="#guidance-on-authentication-schemes" class="auto internal xref">Section 3.2.5</a>
for more information.<a href="#section-3.2.4-1" class="pilcrow">¶</a></p>
<p id="section-3.2.4-2">For the PSK part of the authentication, clients export a dedicated secret:<a href="#section-3.2.4-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.2.4-3">
<pre>
targeted_message_psk
  = DeriveExtensionSecret(extension_secret, "targeted message psk")
</pre><a href="#section-3.2.4-3" class="pilcrow">¶</a>
</div>
<p id="section-3.2.4-4">The functions <code>SealAuth</code> and <code>OpenAuth</code> defined in <span>[<a href="#hpke" class="cite xref">hpke</a>]</span> are used as
described in <a href="#safe-hpke" class="auto internal xref">Section 2.1.5</a> with an empty context. Other functions are defined in
<span>[<a href="#mls-protocol" class="cite xref">mls-protocol</a>]</span>.<a href="#section-3.2.4-4" class="pilcrow">¶</a></p>
<div id="authentication-with-hpke">
<section id="section-3.2.4.1">
            <h5 id="name-authentication-with-hpke">
<a href="#section-3.2.4.1" class="section-number selfRef">3.2.4.1. </a><a href="#name-authentication-with-hpke" class="section-name selfRef">Authentication with HPKE</a>
            </h5>
<p id="section-3.2.4.1-1">The sender MUST set the authentication scheme to
<code>TargetedMessageAuthScheme.HPKEAuthPsk</code>.<a href="#section-3.2.4.1-1" class="pilcrow">¶</a></p>
<p id="section-3.2.4.1-2">As described in <a href="#safe-hpke" class="auto internal xref">Section 2.1.5</a> the <code>hpke_context</code> is a LabeledExtensionContent struct
with the following content, where <code>group_context</code> is the serialized context of
the group.<a href="#section-3.2.4.1-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.2.4.1-3">
<pre>
label = "MLS 1.0 ExtensionData"
extension_type = ExtensionType
extension_data = group_context
</pre><a href="#section-3.2.4.1-3" class="pilcrow">¶</a>
</div>
<p id="section-3.2.4.1-4">The sender then computes the following:<a href="#section-3.2.4.1-4" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.2.4.1-5">
<pre>
(kem_output, hpke_ciphertext) = SealAuthPSK(receiver_node_public_key,
                                            hpke_context,
                                            targeted_message_tbm,
                                            message,
                                            targeted_message_psk,
                                            psk_id,
                                            sender_node_private_key)
</pre><a href="#section-3.2.4.1-5" class="pilcrow">¶</a>
</div>
<p id="section-3.2.4.1-6">The recipient computes the following:<a href="#section-3.2.4.1-6" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.2.4.1-7">
<pre>
message = OpenAuthPSK(kem_output,
                      receiver_node_private_key,
                      hpke_context,
                      targeted_message_tbm,
                      hpke_ciphertext,
                      targeted_message_psk,
                      psk_id,
                      sender_node_public_key)
</pre><a href="#section-3.2.4.1-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="authentication-with-signatures">
<section id="section-3.2.4.2">
            <h5 id="name-authentication-with-signatu">
<a href="#section-3.2.4.2" class="section-number selfRef">3.2.4.2. </a><a href="#name-authentication-with-signatu" class="section-name selfRef">Authentication with signatures</a>
            </h5>
<p id="section-3.2.4.2-1">The sender MUST set the authentication scheme to
<code>TargetedMessageAuthScheme.SignatureHPKEPsk</code>. The signature is done using the
<code>signature_key</code> of the sender's <code>LeafNode</code> and the corresponding signature
scheme used in the group.<a href="#section-3.2.4.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2.4.2-2">The sender then computes the following with <code>hpke_context</code> defined as in
<a href="#authentication-with-hpke" class="auto internal xref">Section 3.2.4.1</a>:<a href="#section-3.2.4.2-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.2.4.2-3">
<pre>
(kem_output, hpke_ciphertext) = SealPSK(receiver_node_public_key,
                                        hpke_context,
                                        targeted_message_tbm,
                                        message,
                                        targeted_message_psk,
                                        epoch)
</pre><a href="#section-3.2.4.2-3" class="pilcrow">¶</a>
</div>
<p id="section-3.2.4.2-4">The signature is computed as follows, where the <code>extension_type</code> is the type of
this extension (see <a href="#iana-considerations" class="auto internal xref">Section 4</a>).<a href="#section-3.2.4.2-4" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.2.4.2-5">
<pre>
signature = SafeSignWithLabel(extension_type, ., "TargetedMessageTBS", targeted_message_tbs)
</pre><a href="#section-3.2.4.2-5" class="pilcrow">¶</a>
</div>
<p id="section-3.2.4.2-6">The recipient computes the following:<a href="#section-3.2.4.2-6" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.2.4.2-7">
<pre>
message = OpenPSK(kem_output,
                  receiver_node_private_key,
                  hpke_context,
                  targeted_message_tbm,
                  hpke_ciphertext,
                  targeted_message_psk,
                  epoch)
</pre><a href="#section-3.2.4.2-7" class="pilcrow">¶</a>
</div>
<p id="section-3.2.4.2-8">The recipient MUST verify the message authentication:<a href="#section-3.2.4.2-8" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.2.4.2-9">
<pre>
SafeVerifyWithLabel.verify(extension_type,
                        sender_leaf_node.signature_key,
                        "TargetedMessageTBS",
                        targeted_message_tbs,
                        signature)
</pre><a href="#section-3.2.4.2-9" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="guidance-on-authentication-schemes">
<section id="section-3.2.5">
          <h4 id="name-guidance-on-authentication-">
<a href="#section-3.2.5" class="section-number selfRef">3.2.5. </a><a href="#name-guidance-on-authentication-" class="section-name selfRef">Guidance on authentication schemes</a>
          </h4>
<p id="section-3.2.5-1">If the group’s ciphersuite does not support HPKE <code>mode_auth_psk</code>,
implementations MUST choose <code>TargetedMessageAuthScheme.SignatureHPKEPsk</code>.<a href="#section-3.2.5-1" class="pilcrow">¶</a></p>
<p id="section-3.2.5-2">If the group’s ciphersuite does support HPKE <code>mode_auth_psk</code>, implementations
CAN choose <code>TargetedMessageAuthScheme.HPKEAuthPsk</code> if better efficiency and/or
repudiability is desired. Implementations SHOULD consult
<span>[<a href="#hpke-security-considerations" class="cite xref">hpke-security-considerations</a>]</span> beforehand.<a href="#section-3.2.5-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="content-advertisement">
<section id="section-3.3">
        <h3 id="name-content-advertisement">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-content-advertisement" class="section-name selfRef">Content Advertisement</a>
        </h3>
<div id="description-2">
<section id="section-3.3.1">
          <h4 id="name-description-3">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-description-3" class="section-name selfRef">Description</a>
          </h4>
<p id="section-3.3.1-1">This section describes two extensions to MLS. The first allows MLS clients
to advertise their support for specific formats inside MLS <code>application_data</code>.
These are expressed using the extensive IANA Media Types registry (formerly
called MIME Types).  The <code>accepted_media_types</code> LeafNode extension lists the
formats a client supports inside <code>application_data</code>. The second, the
<code>required_media_types</code> GroupContext extension specifies which media types
need to be supported by all members of a particular MLS group.
These allow clients to confirm that all members of a group can communicate.
Note that when the membership of a group changes, or when the policy of the
group changes, it is responsibility of the committer to insure that the membership
and policies are compatible.<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2">Finally, this document defines a minimal framing format so MLS clients can signal
which media type is being sent when multiple formats are permitted in the same group.
As clients are upgraded to support new formats they can use these extensions
to detect when all members support a new or more efficient encoding, or select the
relevant format or formats to send.<a href="#section-3.3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.3.1-3">Note that the usage of IANA media types in general does not imply the usage of MIME
Headers <span>[<a href="#RFC2045" class="cite xref">RFC2045</a>]</span> for framing. Vendor-specific media subtypes starting with
<code>vnd.</code> can be registered with IANA without standards action as described in
<span>[<a href="#RFC6838" class="cite xref">RFC6838</a>]</span>.  Implementations which wish to send multiple formats in a single
application message, may be interested in the <code>multipart/alternative</code> media type
defined in <span>[<a href="#RFC2046" class="cite xref">RFC2046</a>]</span> or may use or define another type with similar semantics
(for example using TLS Presentation Language syntax <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>).<a href="#section-3.3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="syntax">
<section id="section-3.3.2">
          <h4 id="name-syntax">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-syntax" class="section-name selfRef">Syntax</a>
          </h4>
<p id="section-3.3.2-1">MediaType is a TLS encoding of a single IANA media type (including top-level
type and subtype) and any of its parameters. Even if the <code>parameter_value</code>
would have required formatting as a <code>quoted-string</code> in a text encoding, only
the contents inside the <code>quoted-string</code> are included in <code>parameter_value</code>.
MediaTypeList is an ordered list of MediaType objects.<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.3.2-2">
<pre>
struct {
    opaque parameter_name&lt;V&gt;;
    /* Note: parameter_value never includes the quotation marks of an
     * RFC 2045 quoted-string */
    opaque parameter_value&lt;V&gt;;
} Parameter;

struct {
    /* media_type is an IANA top-level media type, a "/" character,
     * and the IANA media subtype */
    opaque media_type&lt;V&gt;;

    /* a list of zero or more parameters defined for the subtype */
    Parameter parameters&lt;V&gt;;
} MediaType;

struct {
    MediaType media_types&lt;V&gt;;
} MediaTypeList;

MediaTypeList accepted_media_types;
MediaTypeList required_media_types;
</pre><a href="#section-3.3.2-2" class="pilcrow">¶</a>
</div>
<p id="section-3.3.2-3">Example IANA media types with optional parameters:<a href="#section-3.3.2-3" class="pilcrow">¶</a></p>
<div class="lang-artwork sourcecode" id="section-3.3.2-4">
<pre>
  image/png
  text/plain ;charset="UTF-8"
  application/json
  application/vnd.example.msgbus+cbor
</pre><a href="#section-3.3.2-4" class="pilcrow">¶</a>
</div>
<p id="section-3.3.2-5">For the example media type for <code>text/plain</code>, the <code>media_type</code> field
would be <code>text/plain</code>, <code>parameters</code> would contain a single Parameter
with a <code>parameter_name</code> of <code>charset</code> and a <code>parameter_value</code> of <code>UTF-8</code>.<a href="#section-3.3.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="expected-behavior">
<section id="section-3.3.3">
          <h4 id="name-expected-behavior">
<a href="#section-3.3.3" class="section-number selfRef">3.3.3. </a><a href="#name-expected-behavior" class="section-name selfRef">Expected Behavior</a>
          </h4>
<p id="section-3.3.3-1">An MLS client which implements this section SHOULD include the
<code>accepted_media_types</code> extension in its LeafNodes, listing
all the media types it can receive. As usual, the
client also includes <code>accepted_media_types</code> in its <code>capabilities</code> field in
its LeafNodes (including LeafNodes inside its KeyPackages).<a href="#section-3.3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3.3-2">When creating a new MLS group for an application using this specification,
the group MAY include a <code>required_media_type</code> extension in the GroupContext
Extensions. As usual, the client also includes
<code>required_media_types</code> in its <code>capabilities</code> field in its LeafNodes
(including LeafNodes inside its KeyPackages). When used in a group, the client
MUST include the <code>required_media_types</code> and <code>accepted_media_types</code> extensions
in the list of extensions in RequiredCapabilities.<a href="#section-3.3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3.3-3">MLS clients SHOULD NOT add an MLS client to an MLS group with <code>required_media_types</code>
unless the MLS client advertises it can support all of the required MediaTypes.
As an exception, a client could be preconfigured to know that certain clients
support the requried types. Likewise, an MLS client is already forbidden from
issuing or committing a GroupContextExtensions Proposal which introduces required
extensions which are not supported by all members in the resulting epoch.<a href="#section-3.3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="framing-of-applicationdata">
<section id="section-3.3.4">
          <h4 id="name-framing-of-application_data">
<a href="#section-3.3.4" class="section-number selfRef">3.3.4. </a><a href="#name-framing-of-application_data" class="section-name selfRef">Framing of application_data</a>
          </h4>
<p id="section-3.3.4-1">When an MLS group contains the <code>required_media_types</code> GroupContext extension,
the <code>application_data</code> sent in that group is interpreted as <code>ApplicationFraming</code>
as defined below:<a href="#section-3.3.4-1" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-3.3.4-2">
<pre>
  struct {
      MediaType media_type;
      opaque&lt;V&gt; application_content;
  } ApplicationFraming;
</pre><a href="#section-3.3.4-2" class="pilcrow">¶</a>
</div>
<p id="section-3.3.4-3">The <code>media_type</code> MAY be zero length, in which case, the media type of the
<code>application_content</code> is interpreted as the first MediaType specified in
<code>required_media_types</code>.<a href="#section-3.3.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="selfremove-proposal">
<section id="section-3.4">
        <h3 id="name-selfremove-proposal">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-selfremove-proposal" class="section-name selfRef">SelfRemove Proposal</a>
        </h3>
<p id="section-3.4-1">The design of the MLS protocol prevents a member of
an MLS group from removing itself immediately from the group. (To cause
an immediate change in the group, a member must send a Commit message.
However the sender of a Commit message knows the keying material of the
new epoch and therefore needs to be part of the group.) Instead a member
wishing to remove itself can send a Remove Proposal and wait for another
member to Commit its Proposal.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4-2">Unfortunately, MLS clients that join via an External Commit ignore
pending, but otherwise valid, Remove Proposals. The member trying to remove
itself has to monitor the group and send a new Remove Proposal in every new
epoch until the member is removed. In a
group with a burst of external joiners, a member connected over a
high-latency link (or one that is merely unlucky) might have to wait
several epochs to remove itself. A real-world situation in which this happens
is a member trying to remove itself from a conference call as several dozen
new participants are trying to join (often on the hour).<a href="#section-3.4-2" class="pilcrow">¶</a></p>
<p id="section-3.4-3">This section describes a new <code>SelfRemove</code> Proposal extension type. It is
designed to be included in External Commits.<a href="#section-3.4-3" class="pilcrow">¶</a></p>
<div id="extension-description">
<section id="section-3.4.1">
          <h4 id="name-extension-description">
<a href="#section-3.4.1" class="section-number selfRef">3.4.1. </a><a href="#name-extension-description" class="section-name selfRef">Extension Description</a>
          </h4>
<p id="section-3.4.1-1">This document specifies a new MLS Proposal type called <code>SelfRemove</code>. Its syntax
is described using the TLS Presentation Language [@!RFC8446] below (its content
is an empty struct). It is allowed in External Commits and requires an UpdatePath.
SelfRemove proposals are only allowed in a Commit by reference. SelfRemove
cannot be sent as an external proposal.<a href="#section-3.4.1-1" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-3.4.1-2">
<pre>
struct {} SelfRemove;

struct {
    ProposalType msg_type;
    select (Proposal.msg_type) {
        case add:                      Add;
        case update:                   Update;
        case remove:                   Remove;
        case psk:                      PreSharedKey;
        case reinit:                   ReInit;
        case external_init:            ExternalInit;
        case group_context_extensions: GroupContextExtensions;
        case self_remove:              SelfRemove;
    };
} Proposal;
</pre><a href="#section-3.4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.4.1-3">The description of behavior below only applies if all the
members of a group support this extension in their
capabilities; such a group is a "self-remove-capable group".<a href="#section-3.4.1-3" class="pilcrow">¶</a></p>
<p id="section-3.4.1-4">An MLS client which supports this extension can send a
SelfRemove Proposal whenever it would like to remove itself
from a self-remove-capable group. Because the point of a
SelfRemove Proposal is to be available to external joiners
(which are not yet members), these proposals MUST be sent
in an MLS PublicMessage.<a href="#section-3.4.1-4" class="pilcrow">¶</a></p>
<p id="section-3.4.1-5">Whenever a member receives a SelfRemove Proposal, it includes
it along with any other pending Propsals when sending a Commit.
It already MUST send a Commit of pending Proposals before sending
new application messages.<a href="#section-3.4.1-5" class="pilcrow">¶</a></p>
<p id="section-3.4.1-6">When a member receives a Commit referencing one or more SelfRemove Proposals,
it treats the proposal like a Remove Proposal, except the leaf node to remove
is determined by looking in the Sender <code>leaf_index</code> of the original Proposal.
The member is able to verify that the Sender was a member.<a href="#section-3.4.1-6" class="pilcrow">¶</a></p>
<p id="section-3.4.1-7">Whenever a new joiner is about to join a self-remove-capable group with an
External Commit, the new joiner MUST fetch any pending SelfRemove Proposals
along with the GroupInfo object, and include the SelfRemove Proposals
in its External Commit by reference. (An ExternalCommit can contain zero or
more SelfRemove proposals). The new joiner MUST validate the SelfRemove
Proposal before including it by reference, except that it skips the validation
of the <code>membership_tag</code> because a non-member cannot verify membership.<a href="#section-3.4.1-7" class="pilcrow">¶</a></p>
<p id="section-3.4.1-8">During validation, SelfRemove proposals are processed after Update proposals
and before Remove proposals. If there is a pending SelfRemove proposal for a specific
leaf node and a pending Remove proposal for the same leaf node, the Remove proposal is
invalid. A client MUST NOT issue more than one SelfRemove proposal per epoch.<a href="#section-3.4.1-8" class="pilcrow">¶</a></p>
<p id="section-3.4.1-9">The MLS Delivery Service (DS) needs to validate SelfRemove Proposals it
receives (except that it cannot validate the <code>membership_tag</code>). If the DS
provides a GroupInfo object to an external joiner, the DS SHOULD attach any
SelfRemove proposals known to the DS to the GroupInfo object.<a href="#section-3.4.1-9" class="pilcrow">¶</a></p>
<p id="section-3.4.1-10">As with Remove proposals, clients need to be able to receive a Commit
message which removes them from the group via a SelfRemove. If the DS does
not forward a Commit to a removed client, it needs to inform the removed
client out-of-band.<a href="#section-3.4.1-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="last-resort-keypackages">
<section id="section-3.5">
        <h3 id="name-last-resort-keypackages">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-last-resort-keypackages" class="section-name selfRef">Last resort KeyPackages</a>
        </h3>
<p id="section-3.5-1">Type: KeyPackage extension<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<div id="description-3">
<section id="section-3.5.1">
          <h4 id="name-description-4">
<a href="#section-3.5.1" class="section-number selfRef">3.5.1. </a><a href="#name-description-4" class="section-name selfRef">Description</a>
          </h4>
<p id="section-3.5.1-1">Section 10 of <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span> details that clients are required to pre-publish
KeyPackages s.t. other clients can add them to groups asynchronously. It also
states that they should not be re-used:<a href="#section-3.5.1-1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-3.5.1-2.1">
              <p id="section-3.5.1-2.1.1">KeyPackages are intended to be used only once and SHOULD NOT be reused except
in the case of a "last resort" KeyPackage (see Section 16.8). Clients MAY
generate and publish multiple KeyPackages to support multiple cipher suites.<a href="#section-3.5.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-3.5.1-3">Section 16.8 of <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span> then introduces the notion of last-resort
KeyPackages as follows:<a href="#section-3.5.1-3" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-3.5.1-4.1">
              <p id="section-3.5.1-4.1.1">An application MAY allow for reuse of a "last resort" KeyPackage in order to
prevent denial-of-service attacks.<a href="#section-3.5.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-3.5.1-5">However, <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span> does not specify how to distinguish regular KeyPackages
from last-resort ones. The last_resort_key_package KeyPackage extension defined
in this section fills this gap and allows clients to specifically mark
KeyPackages as KeyPackages of last resort that MAY be used more than once in
scenarios where all other KeyPackages have already been used.<a href="#section-3.5.1-5" class="pilcrow">¶</a></p>
<p id="section-3.5.1-6">The extension allows clients that pre-publish KeyPackages to signal to the
Delivery Service which KeyPackage(s) are meant to be used as last resort
KeyPackages.<a href="#section-3.5.1-6" class="pilcrow">¶</a></p>
<p id="section-3.5.1-7">An additional benefit of using an extension rather than communicating the
information out-of-band is that the extension is still present in Add proposals.
Clients processing such Add proposals can authenticate that a KeyPackage is a
last-resort KeyPackage and MAY make policy decisions based on that information.<a href="#section-3.5.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="format-1">
<section id="section-3.5.2">
          <h4 id="name-format-2">
<a href="#section-3.5.2" class="section-number selfRef">3.5.2. </a><a href="#name-format-2" class="section-name selfRef">Format</a>
          </h4>
<p id="section-3.5.2-1">The purpose of the extension is simply to mark a given KeyPackage, which means
it carries no additional data.<a href="#section-3.5.2-1" class="pilcrow">¶</a></p>
<p id="section-3.5.2-2">As a result, a LastResort Extension contains the ExtensionType with an empty
<code>extension_data</code> field.<a href="#section-3.5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-4">
      <h2 id="name-iana-considerations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-4-1">This document requests the addition of various new values under the heading
of "Messaging Layer Security".  Each registration is organized under the
relevant registry Type.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">RFC EDITOR: Please replace XXXX throughout with the RFC number assigned to
this document<a href="#section-4-2" class="pilcrow">¶</a></p>
<div id="mls-wire-formats">
<section id="section-4.1">
        <h3 id="name-mls-wire-formats">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-mls-wire-formats" class="section-name selfRef">MLS Wire Formats</a>
        </h3>
<div id="mls-extension-message">
<section id="section-4.1.1">
          <h4 id="name-mls-extension-message">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-mls-extension-message" class="section-name selfRef">MLS Extension Message</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-4.1.1-1.1">
              <p id="section-4.1.1-1.1.1">Value: 0x0006<a href="#section-4.1.1-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-1.2">
              <p id="section-4.1.1-1.2.1">Name: mls_extension_message<a href="#section-4.1.1-1.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-1.3">
              <p id="section-4.1.1-1.3.1">Recommended: Y<a href="#section-4.1.1-1.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-1.4">
              <p id="section-4.1.1-1.4.1">Reference: RFC XXXX<a href="#section-4.1.1-1.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="mls-extension-types">
<section id="section-4.2">
        <h3 id="name-mls-extension-types">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-mls-extension-types" class="section-name selfRef">MLS Extension Types</a>
        </h3>
<p id="section-4.2-1">This document updates the MLS Extension Types registry to insert a new
column ("Safe") between the "Recommended" column and the "Reference"
column. The value of the "Safe" column for the first (0x0000) and last
(0xF000-0xFFFF) rows is "-" while the value of all other existing rows is
"N".<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.1">
            <p id="section-4.2-2.1.1">Safe: Whether the extension is a Safe Extension as defined in Section 2 of
 RFC XXXX.  Valid values are:<a href="#section-4.2-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.1.2.1">
                <p id="section-4.2-2.1.2.1.1">"Y", indicating the extension is a Safe Extension;<a href="#section-4.2-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.2-2.1.2.2">
                <p id="section-4.2-2.1.2.2.1">"N", indicating the extension is not a Safe Extension; or<a href="#section-4.2-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.2-2.1.2.3">
                <p id="section-4.2-2.1.2.3.1">"-", indicating a reserved value which is not a single extension.<a href="#section-4.2-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-4.2-3">This document also extends the list of allowable values for the "Message(s)"
column, such that the list may be empty (represented by "-") if the
extension is a Safe Extension.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<div id="targetedmessagescapability-mls-extension">
<section id="section-4.2.1">
          <h4 id="name-targeted_messages_capabilit">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-targeted_messages_capabilit" class="section-name selfRef">targeted_messages_capability MLS Extension</a>
          </h4>
<p id="section-4.2.1-1">The <code>targeted_messages_capability</code> MLS Extension Type is used in the
capabilities field of LeafNodes to indicate the support for the Targeted
Messages Extension. The extension does not carry any payload.<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-2.1">
              <p id="section-4.2.1-2.1.1">Value: 0x0006 (suggested)<a href="#section-4.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.1-2.2">
              <p id="section-4.2.1-2.2.1">Name: targeted_messages_capability<a href="#section-4.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.1-2.3">
              <p id="section-4.2.1-2.3.1">Message(s): LN: This extension may appear in LeafNode objects<a href="#section-4.2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.1-2.4">
              <p id="section-4.2.1-2.4.1">Recommended: Y<a href="#section-4.2.1-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.1-2.5">
              <p id="section-4.2.1-2.5.1">Safe: Y<a href="#section-4.2.1-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.1-2.6">
              <p id="section-4.2.1-2.6.1">Reference: RFC XXXX<a href="#section-4.2.1-2.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="targetedmessages-mls-extension">
<section id="section-4.2.2">
          <h4 id="name-targeted_messages-mls-exten">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-targeted_messages-mls-exten" class="section-name selfRef">targeted_messages MLS Extension</a>
          </h4>
<p id="section-4.2.2-1">The <code>targeted_messages</code> MLS Extension Type is used inside GroupContext objects. It
indicates that the group supports the Targeted Messages Extension.<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2-2.1">
              <p id="section-4.2.2-2.1.1">Value: 0x0007 (suggested)<a href="#section-4.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.2-2.2">
              <p id="section-4.2.2-2.2.1">Name: targeted_messages<a href="#section-4.2.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.2-2.3">
              <p id="section-4.2.2-2.3.1">Message(s): GC: This extension may appear in GroupContext objects<a href="#section-4.2.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.2-2.4">
              <p id="section-4.2.2-2.4.1">Recommended: Y<a href="#section-4.2.2-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.2-2.5">
              <p id="section-4.2.2-2.5.1">Safe: Y<a href="#section-4.2.2-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.2-2.6">
              <p id="section-4.2.2-2.6.1">Reference: RFC XXXX<a href="#section-4.2.2-2.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="acceptedmediatypes-mls-extension">
<section id="section-4.2.3">
          <h4 id="name-accepted_media_types-mls-ex">
<a href="#section-4.2.3" class="section-number selfRef">4.2.3. </a><a href="#name-accepted_media_types-mls-ex" class="section-name selfRef">accepted_media_types MLS Extension</a>
          </h4>
<p id="section-4.2.3-1">The <code>accepted_media_types</code> MLS Extension Type is used inside LeafNode objects. It
contains a MediaTypeList representing all the media types supported by the
MLS client referred to by the LeafNode.<a href="#section-4.2.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.3-2.1">
              <p id="section-4.2.3-2.1.1">Value: 0x0008 (suggested)<a href="#section-4.2.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.3-2.2">
              <p id="section-4.2.3-2.2.1">Name: accepted_media_types<a href="#section-4.2.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.3-2.3">
              <p id="section-4.2.3-2.3.1">Message(s): LN: This extension may appear in LeafNode objects<a href="#section-4.2.3-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.3-2.4">
              <p id="section-4.2.3-2.4.1">Recommended: Y<a href="#section-4.2.3-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.3-2.5">
              <p id="section-4.2.3-2.5.1">Safe: Y<a href="#section-4.2.3-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.3-2.6">
              <p id="section-4.2.3-2.6.1">Reference: RFC XXXX<a href="#section-4.2.3-2.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="requiredmediatypes-mls-extension">
<section id="section-4.2.4">
          <h4 id="name-required_media_types-mls-ex">
<a href="#section-4.2.4" class="section-number selfRef">4.2.4. </a><a href="#name-required_media_types-mls-ex" class="section-name selfRef">required_media_types MLS Extension</a>
          </h4>
<p id="section-4.2.4-1">The required_media_types MLS Extension Type is used inside GroupContext objects. It
contains a MediaTypeList representing the media types which are mandatory for all
MLS members of the group to support.<a href="#section-4.2.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.4-2.1">
              <p id="section-4.2.4-2.1.1">Value: 0x0009 (suggested)<a href="#section-4.2.4-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.4-2.2">
              <p id="section-4.2.4-2.2.1">Name: required_media_types<a href="#section-4.2.4-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.4-2.3">
              <p id="section-4.2.4-2.3.1">Message(s): GC: This extension may appear in GroupContext objects<a href="#section-4.2.4-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.4-2.4">
              <p id="section-4.2.4-2.4.1">Recommended: Y<a href="#section-4.2.4-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.4-2.5">
              <p id="section-4.2.4-2.5.1">Safe: Y<a href="#section-4.2.4-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.4-2.6">
              <p id="section-4.2.4-2.6.1">Reference: RFC XXXX<a href="#section-4.2.4-2.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="lastresortkeypackage-mls-extension">
<section id="section-4.2.5">
          <h4 id="name-last_resort_key_package-mls">
<a href="#section-4.2.5" class="section-number selfRef">4.2.5. </a><a href="#name-last_resort_key_package-mls" class="section-name selfRef">last_resort_key_package MLS Extension</a>
          </h4>
<p id="section-4.2.5-1">The last_resort_key_package MLS Extension Type is used inside KeyPackage
objects. It marks the KeyPackage for usage in last resort scenarios and contains
no additional data.<a href="#section-4.2.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.5-2.1">
              <p id="section-4.2.5-2.1.1">Value: 0x000A (suggested)<a href="#section-4.2.5-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.5-2.2">
              <p id="section-4.2.5-2.2.1">Name: last_resort_key_package<a href="#section-4.2.5-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.5-2.3">
              <p id="section-4.2.5-2.3.1">Message(s): KP: This extension may appear in KeyPackage objects<a href="#section-4.2.5-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.5-2.4">
              <p id="section-4.2.5-2.4.1">Recommended: Y<a href="#section-4.2.5-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.5-2.5">
              <p id="section-4.2.5-2.5.1">Safe: Y<a href="#section-4.2.5-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.5-2.6">
              <p id="section-4.2.5-2.6.1">Reference: RFC XXXX<a href="#section-4.2.5-2.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="extensionaad-mls-extension">
<section id="section-4.2.6">
          <h4 id="name-extension_aad-mls-extension">
<a href="#section-4.2.6" class="section-number selfRef">4.2.6. </a><a href="#name-extension_aad-mls-extension" class="section-name selfRef">extension_aad MLS Extension</a>
          </h4>
<p id="section-4.2.6-1">The extension_aad MLS Extension Type is used to signal support for <code>SafeAAD</code>
in LeafNode capabilities, and in GroupContext <code>required_capabilities</code>. It contains no additional data.<a href="#section-4.2.6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.6-2.1">
              <p id="section-4.2.6-2.1.1">Value: 0x000B (suggested)<a href="#section-4.2.6-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.6-2.2">
              <p id="section-4.2.6-2.2.1">Name: extension_aad<a href="#section-4.2.6-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.6-2.3">
              <p id="section-4.2.6-2.3.1">Message(s): LN,GC: This extension may appear in LeafNode and GroupContext
objects.<a href="#section-4.2.6-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.6-2.4">
              <p id="section-4.2.6-2.4.1">Recommended: Y<a href="#section-4.2.6-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.6-2.5">
              <p id="section-4.2.6-2.5.1">Safe: Y<a href="#section-4.2.6-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.6-2.6">
              <p id="section-4.2.6-2.6.1">Reference: RFC XXXX<a href="#section-4.2.6-2.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="safeextensions-mls-extension">
<section id="section-4.2.7">
          <h4 id="name-safe_extensions-mls-extensi">
<a href="#section-4.2.7" class="section-number selfRef">4.2.7. </a><a href="#name-safe_extensions-mls-extensi" class="section-name selfRef">safe_extensions MLS Extension</a>
          </h4>
<p id="section-4.2.7-1">The <code>safe_extensions</code> MLS Extension Type is used to signal support for the
Safe Extensions Framework in LeafNode capabilities, and in GroupContext
<code>required_capabilities</code>. It contains no additional data.<a href="#section-4.2.7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.7-2.1">
              <p id="section-4.2.7-2.1.1">Value: 0x000C (suggested)<a href="#section-4.2.7-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.7-2.2">
              <p id="section-4.2.7-2.2.1">Name: safe_extensions<a href="#section-4.2.7-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.7-2.3">
              <p id="section-4.2.7-2.3.1">Message(s): LN,GC: This extension may appear in LeafNode and GroupContext
objects.<a href="#section-4.2.7-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.7-2.4">
              <p id="section-4.2.7-2.4.1">Recommended: Y<a href="#section-4.2.7-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.7-2.5">
              <p id="section-4.2.7-2.5.1">Safe: Y<a href="#section-4.2.7-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.7-2.6">
              <p id="section-4.2.7-2.6.1">Reference: RFC XXXX<a href="#section-4.2.7-2.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="corestructextensions-mls-extension">
<section id="section-4.2.8">
          <h4 id="name-core_struct_extensions-mls-">
<a href="#section-4.2.8" class="section-number selfRef">4.2.8. </a><a href="#name-core_struct_extensions-mls-" class="section-name selfRef">core_struct_extensions MLS Extension</a>
          </h4>
<p id="section-4.2.8-1">The <code>core_struct_extensions</code> MLS Extension Type is used to signal support
for one or more Core Struct Extensions using the Safe Extensions Framework.
It appears in LeafNode capabilities, and in GroupContext
<code>required_capabilities</code>. It contains no additional data.<a href="#section-4.2.8-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.8-2.1">
              <p id="section-4.2.8-2.1.1">Value: 0x000D (suggested)<a href="#section-4.2.8-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.8-2.2">
              <p id="section-4.2.8-2.2.1">Name: core_struct_extensions<a href="#section-4.2.8-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.8-2.3">
              <p id="section-4.2.8-2.3.1">Message(s): LN,GC: This extension may appear in LeafNode and GroupContext
objects.<a href="#section-4.2.8-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.8-2.4">
              <p id="section-4.2.8-2.4.1">Recommended: Y<a href="#section-4.2.8-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.8-2.5">
              <p id="section-4.2.8-2.5.1">Safe: Y<a href="#section-4.2.8-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.8-2.6">
              <p id="section-4.2.8-2.6.1">Reference: RFC XXXX<a href="#section-4.2.8-2.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="mls-proposal-types">
<section id="section-4.3">
        <h3 id="name-mls-proposal-types">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-mls-proposal-types" class="section-name selfRef">MLS Proposal Types</a>
        </h3>
<div id="extension-proposal">
<section id="section-4.3.1">
          <h4 id="name-extension-proposal">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-extension-proposal" class="section-name selfRef">Extension Proposal</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-4.3.1-1.1">
              <p id="section-4.3.1-1.1.1">Value: 0x0008 (suggested)<a href="#section-4.3.1-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.1-1.2">
              <p id="section-4.3.1-1.2.1">Name: extension_proposal<a href="#section-4.3.1-1.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.1-1.3">
              <p id="section-4.3.1-1.3.1">Recommended: Y<a href="#section-4.3.1-1.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.1-1.4">
              <p id="section-4.3.1-1.4.1">Path Required: N<a href="#section-4.3.1-1.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.1-1.5">
              <p id="section-4.3.1-1.5.1">External Sender: N<a href="#section-4.3.1-1.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.1-1.6">
              <p id="section-4.3.1-1.6.1">Reference: RFC XXXX<a href="#section-4.3.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="extension-path-proposal">
<section id="section-4.3.2">
          <h4 id="name-extension-path-proposal">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-extension-path-proposal" class="section-name selfRef">Extension Path Proposal</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-4.3.2-1.1">
              <p id="section-4.3.2-1.1.1">Value: 0x0009 (suggested)<a href="#section-4.3.2-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.2-1.2">
              <p id="section-4.3.2-1.2.1">Name: extension_path_proposal<a href="#section-4.3.2-1.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.2-1.3">
              <p id="section-4.3.2-1.3.1">Recommended: Y<a href="#section-4.3.2-1.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.2-1.4">
              <p id="section-4.3.2-1.4.1">Path Required: Y<a href="#section-4.3.2-1.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.2-1.5">
              <p id="section-4.3.2-1.5.1">External Sender: N<a href="#section-4.3.2-1.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.2-1.6">
              <p id="section-4.3.2-1.6.1">Reference: RFC XXXX<a href="#section-4.3.2-1.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="extension-external-proposal">
<section id="section-4.3.3">
          <h4 id="name-extension-external-proposal">
<a href="#section-4.3.3" class="section-number selfRef">4.3.3. </a><a href="#name-extension-external-proposal" class="section-name selfRef">Extension External Proposal</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-4.3.3-1.1">
              <p id="section-4.3.3-1.1.1">Value: 0x000a (suggested)<a href="#section-4.3.3-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.3-1.2">
              <p id="section-4.3.3-1.2.1">Name: extension_external_proposal<a href="#section-4.3.3-1.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.3-1.3">
              <p id="section-4.3.3-1.3.1">Recommended: Y<a href="#section-4.3.3-1.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.3-1.4">
              <p id="section-4.3.3-1.4.1">Path Required: N<a href="#section-4.3.3-1.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.3-1.5">
              <p id="section-4.3.3-1.5.1">External Sender: Y<a href="#section-4.3.3-1.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.3-1.6">
              <p id="section-4.3.3-1.6.1">Reference: RFC XXXX<a href="#section-4.3.3-1.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="appack-proposal">
<section id="section-4.3.4">
          <h4 id="name-appack-proposal">
<a href="#section-4.3.4" class="section-number selfRef">4.3.4. </a><a href="#name-appack-proposal" class="section-name selfRef">AppAck Proposal</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-4.3.4-1.1">
              <p id="section-4.3.4-1.1.1">Value: 0x000b (suggested)<a href="#section-4.3.4-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.4-1.2">
              <p id="section-4.3.4-1.2.1">Name: app_ack<a href="#section-4.3.4-1.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.4-1.3">
              <p id="section-4.3.4-1.3.1">Recommended: Y<a href="#section-4.3.4-1.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.4-1.4">
              <p id="section-4.3.4-1.4.1">Path Required: Y<a href="#section-4.3.4-1.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.4-1.5">
              <p id="section-4.3.4-1.5.1">Reference: RFC XXXX<a href="#section-4.3.4-1.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="selfremove-proposal-1">
<section id="section-4.3.5">
          <h4 id="name-selfremove-proposal-2">
<a href="#section-4.3.5" class="section-number selfRef">4.3.5. </a><a href="#name-selfremove-proposal-2" class="section-name selfRef">SelfRemove Proposal</a>
          </h4>
<p id="section-4.3.5-1">The <code>self_remove</code> MLS Proposal Type is used for a member to remove itself
from a group more efficiently than using a <code>remove</code> proposal type, as the
<code>self_remove</code> type is permitted in External Commits.<a href="#section-4.3.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.5-2.1">
              <p id="section-4.3.5-2.1.1">Value: 0x000c (suggested)<a href="#section-4.3.5-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.5-2.2">
              <p id="section-4.3.5-2.2.1">Name: self_remove<a href="#section-4.3.5-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.5-2.3">
              <p id="section-4.3.5-2.3.1">Recommended: Y<a href="#section-4.3.5-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.5-2.4">
              <p id="section-4.3.5-2.4.1">External: N<a href="#section-4.3.5-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.5-2.5">
              <p id="section-4.3.5-2.5.1">Path Required: Y<a href="#section-4.3.5-2.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="mls-credential-types">
<section id="section-4.4">
        <h3 id="name-mls-credential-types">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-mls-credential-types" class="section-name selfRef">MLS Credential Types</a>
        </h3>
<div id="extension-credential">
<section id="section-4.4.1">
          <h4 id="name-extension-credential">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-extension-credential" class="section-name selfRef">Extension Credential</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-4.4.1-1.1">
              <p id="section-4.4.1-1.1.1">Value: 0x0003 (suggested)<a href="#section-4.4.1-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-1.2">
              <p id="section-4.4.1-1.2.1">Name: extension_credential<a href="#section-4.4.1-1.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-1.3">
              <p id="section-4.4.1-1.3.1">Recommended: Y<a href="#section-4.4.1-1.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-1.4">
              <p id="section-4.4.1-1.4.1">Reference: RFC XXXX<a href="#section-4.4.1-1.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="mls-signature-labels">
<section id="section-4.5">
        <h3 id="name-mls-signature-labels">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-mls-signature-labels" class="section-name selfRef">MLS Signature Labels</a>
        </h3>
<div id="labeled-extension-content">
<section id="section-4.5.1">
          <h4 id="name-labeled-extension-content">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-labeled-extension-content" class="section-name selfRef">Labeled Extension Content</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-4.5.1-1.1">
              <p id="section-4.5.1-1.1.1">Label: "LabeledExtensionContent" (suggested)<a href="#section-4.5.1-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.5.1-1.2">
              <p id="section-4.5.1-1.2.1">Recommended: Y<a href="#section-4.5.1-1.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.5.1-1.3">
              <p id="section-4.5.1-1.3.1">Reference: RFC XXXX<a href="#section-4.5.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="mls-extension-types-1">
<section id="section-4.6">
        <h3 id="name-mls-extension-types-2">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-mls-extension-types-2" class="section-name selfRef">MLS Extension Types</a>
        </h3>
<p id="section-4.6-1">This document modifies the rules of the "MLS Extension Types" registry
to add a new Message type as follows:<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6-2.1">
            <p id="section-4.6-2.1.1">AD: Authenticated Additional Data<a href="#section-4.6-2.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.6-3">The <code>AD</code> Message type refers to an <code>ExtensionType</code> used inside the
<code>SafeAADItem</code> structure defined in <a href="#safe-aad" class="auto internal xref">Section 2.1.9.5</a>.<a href="#section-4.6-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security considerations</a>
      </h2>
<div id="appack-1">
<section id="section-5.1">
        <h3 id="name-appack-2">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-appack-2" class="section-name selfRef">AppAck</a>
        </h3>
<p id="section-5.1-1">TBC<a href="#section-5.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="targeted-messages-1">
<section id="section-5.2">
        <h3 id="name-targeted-messages-2">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-targeted-messages-2" class="section-name selfRef">Targeted Messages</a>
        </h3>
<p id="section-5.2-1">In addition to the sender authentication, Targeted Messages are authenticated by
using a preshared key (PSK) between the sender and the recipient. The PSK is
exported from the group key schedule using the label "targeted message psk".
This ensures that the PSK is only valid for a specific group and epoch, and the
Forward Secrecy and Post-Compromise Security guarantees of the group key
schedule apply to the targeted messages as well. The PSK also ensures that an
attacker needs access to the private group state in addition to the
HPKE/signature's private keys. This improves confidentiality guarantees against
passive attackers and authentication guarantees against active attackers.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="content-advertisement-1">
<section id="section-5.3">
        <h3 id="name-content-advertisement-2">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-content-advertisement-2" class="section-name selfRef">Content Advertisement</a>
        </h3>
<p id="section-5.3-1">Use of the <code>accepted_media_types</code> and <code>rejected_media_types</code> extensions
could leak some private information visible in KeyPackages and inside an MLS group.
They could be used to infer a specific implementation, platform, or even version.
Clients should consider carefully the privacy implications in their environment of
making a list of acceptable media types available.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="selfremove">
<section id="section-5.4">
        <h3 id="name-selfremove">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-selfremove" class="section-name selfRef">SelfRemove</a>
        </h3>
<p id="section-5.4-1">An external recipient of a SelfRemove Proposal cannot verify the
<code>membership_tag</code>. However, an external joiner also has no way to
completely validate a GroupInfo object that it receives. An insider
can prevent an External Join by providing either an invalid GroupInfo object
or an invalid SelfRemove Proposal. The security properties of external joins
does not change with the addition of this proposal type.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-6">
      <h2 id="name-references">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-6.1">
        <h3 id="name-normative-references">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9180">[RFC9180]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9420">[RFC9420]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Beurdouche, B.</span>, <span class="refAuthor">Robert, R.</span>, <span class="refAuthor">Millican, J.</span>, <span class="refAuthor">Omara, E.</span>, and <span class="refAuthor">K. Cohn-Gordon</span>, <span class="refTitle">"The Messaging Layer Security (MLS) Protocol"</span>, <span class="seriesInfo">RFC 9420</span>, <span class="seriesInfo">DOI 10.17487/RFC9420</span>, <time datetime="2023-07" class="refDate">July 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9420">https://www.rfc-editor.org/rfc/rfc9420</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-6.2">
        <h3 id="name-informative-references">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="hpke">[hpke]</dt>
        <dd>
<span class="refTitle">"Hybrid Public Key Encryption"</span>, <span>n.d.</span>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180.html](https://www.rfc-editor.org/rfc/rfc9180.html">https://www.rfc-editor.org/rfc/rfc9180.html](https://www.rfc-editor.org/rfc/rfc9180.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="hpke-security-considerations">[hpke-security-considerations]</dt>
        <dd>
<span class="refTitle">"HPKE Security Considerations"</span>, <span>n.d.</span>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180.html#name-key-compromise-impersonatio](https://www.rfc-editor.org/rfc/rfc9180.html#name-key-compromise-impersonatio">https://www.rfc-editor.org/rfc/rfc9180.html#name-key-compromise-impersonatio](https://www.rfc-editor.org/rfc/rfc9180.html#name-key-compromise-impersonatio</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="mls-protocol">[mls-protocol]</dt>
        <dd>
<span class="refTitle">"The Messaging Layer Security (MLS) Protocol"</span>, <span>n.d.</span>, <span>&lt;<a href="https://datatracker.ietf.org/doc/draft-ietf-mls-protocol/](https://datatracker.ietf.org/doc/draft-ietf-mls-protocol/">https://datatracker.ietf.org/doc/draft-ietf-mls-protocol/](https://datatracker.ietf.org/doc/draft-ietf-mls-protocol/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2045">[RFC2045]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span> and <span class="refAuthor">N. Borenstein</span>, <span class="refTitle">"Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies"</span>, <span class="seriesInfo">RFC 2045</span>, <span class="seriesInfo">DOI 10.17487/RFC2045</span>, <time datetime="1996-11" class="refDate">November 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2045">https://www.rfc-editor.org/rfc/rfc2045</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2046">[RFC2046]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span> and <span class="refAuthor">N. Borenstein</span>, <span class="refTitle">"Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types"</span>, <span class="seriesInfo">RFC 2046</span>, <span class="seriesInfo">DOI 10.17487/RFC2046</span>, <time datetime="1996-11" class="refDate">November 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2046">https://www.rfc-editor.org/rfc/rfc2046</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6838">[RFC6838]</dt>
      <dd>
<span class="refAuthor">Freed, N.</span>, <span class="refAuthor">Klensin, J.</span>, and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"Media Type Specifications and Registration Procedures"</span>, <span class="seriesInfo">BCP 13</span>, <span class="seriesInfo">RFC 6838</span>, <span class="seriesInfo">DOI 10.17487/RFC6838</span>, <time datetime="2013-01" class="refDate">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6838">https://www.rfc-editor.org/rfc/rfc6838</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="contributors">
<section id="appendix-A">
      <h2 id="name-contributors">
<a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Joel Alwen</span></div>
<div dir="auto" class="left"><span class="org">Amazon</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:alwenjo@amazon.com" class="email">alwenjo@amazon.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Konrad Kohbrok</span></div>
<div dir="auto" class="left"><span class="org">Phoenix R&amp;D</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:konrad.kohbrok@datashrine.de" class="email">konrad.kohbrok@datashrine.de</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Rohan Mahy</span></div>
<div dir="auto" class="left"><span class="org">Rohan Mahy Consulting Services</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rohan.ietf@gmail.com" class="email">rohan.ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Marta Mularczyk</span></div>
<div dir="auto" class="left"><span class="org">Amazon</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mulmarta@amazon.com" class="email">mulmarta@amazon.com</a>
</div>
</address>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Raphael Robert</span></div>
<div dir="auto" class="left"><span class="org">Phoenix R&amp;D</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ietf@raphaelrobert.com" class="email">ietf@raphaelrobert.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
